<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pequena Ajuda - Assistente de IA</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- KaTeX for LaTeX Math Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMeaPoAbJNdFBsSLMJiTsvpgJV+a1xRRiF78kBOAOkex4IILw" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: url('https://images.pexels.com/photos/5428260/pexels-photo-5428260.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .katex { font-size: 1.1em !important; }
        
        /* Periodic table styles */
        .periodic-table-grid {
            display: grid;
            grid-template-columns: repeat(18, minmax(0, 1fr));
            gap: 4px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .element-cell {
            position: relative; background-color: #e2e8f0; border-radius: 0.5rem;
            padding: 4px; font-size: 0.75rem; text-align: center;
            cursor: pointer; transition: all 0.2s ease; color: #1f2937;
        }
        .element-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .element-number { font-size: 0.625rem; position: absolute; top: 2px; left: 2px; }
        .element-symbol { font-weight: bold; font-size: 1.25rem; }
        .metal-alcalino { background-color: #fca5a5; }
        .metal-alcalino-terroso { background-color: #fcd34d; }
        .metal-de-transicao { background-color: #a5f3fc; }
        .metal-pos-transicao { background-color: #93c5fd; }
        .semimetal { background-color: #c4b5fd; }
        .nao-metal { background-color: #86efac; }
        .halogenio { background-color: #a7f3d0; }
        .gas-nobre { background-color: #d1d5db; }
        .lantanideo, .actinideo { background-color: #f9a8d4; }
        .lanthanide-actinide-placeholder { background-color: #d1d5db; color: #4b5563; }
        .lanthanide-container, .actinide-container {
            display: grid; grid-template-columns: repeat(15, minmax(0, 1fr));
            gap: 4px; margin-top: 1rem; font-size: 0.65rem; overflow-x: auto;
        }
    </style>
</head>
<body class="text-gray-800 dark:text-gray-200 transition-colors duration-300 flex items-center justify-center min-h-screen">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-4xl bg-white/80 dark:bg-gray-900/90 backdrop-blur-sm rounded-2xl shadow-2xl my-8">
        
        <!-- Header -->
        <header class="text-center mb-8 relative">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-teal-400">
                Pequena Ajuda
            </h1>
            <p class="mt-2 text-base sm:text-lg text-gray-700 dark:text-gray-300">Sua assistente de estudos, cálculos e conversões</p>
        </header>

        <!-- Auth View -->
        <section id="auth-view" class="hidden w-full">
             <div class="bg-white/80 dark:bg-gray-800/90 p-6 rounded-2xl shadow-lg max-w-lg mx-auto">
                
                <!-- Login Form -->
                <div id="login-form-container" class="hidden">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-gray-800 dark:text-white text-center">Entrar</h2>
                    <form id="login-form">
                        <div class="mb-4">
                            <label for="login-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">E-mail</label>
                            <input type="email" id="login-email" name="email" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div class="mb-4">
                            <label for="login-senha" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Senha</label>
                            <input type="password" id="login-senha" name="senha" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <button type="submit" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg text-lg transition-transform transform hover:scale-105">
                            Entrar
                        </button>
                        <p id="login-feedback" class="text-center mt-4 font-semibold"></p>
                    </form>
                    <p class="text-center mt-4 text-sm">
                        Não tem uma conta? 
                        <a href="#" id="show-register-form" class="font-medium text-blue-600 hover:underline">Registe-se</a>
                    </p>
                </div>

                <!-- Register Form -->
                <div id="register-form-container" class="hidden">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-gray-800 dark:text-white text-center">Bem-vindo(a)!</h2>
                    <p class="text-gray-700 dark:text-gray-300 mb-6 text-center">Para começar, por favor, crie a sua conta.</p>
                    <form id="register-form" action="https://formspree.io/f/xjkeplqy" method="POST">
                        <input type="hidden" name="_subject" value="Novo Registo no App Pequena Ajuda!">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="register-nome" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nome</label>
                                <input type="text" id="register-nome" name="nome" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                            <div>
                                <label for="register-sobrenome" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Sobrenome</label>
                                <input type="text" id="register-sobrenome" name="sobrenome" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                        </div>
                        <div class="mb-4">
                             <label for="register-idade" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Idade</label>
                             <input type="number" id="register-idade" name="idade" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div class="mb-4">
                             <label for="register-cidade" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cidade / Estado</label>
                             <input type="text" id="register-cidade" name="cidade_estado" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" placeholder="Ex: Uberlândia / MG" required>
                        </div>
                         <div class="mb-4">
                             <label for="register-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">E-mail</label>
                             <input type="email" id="register-email" name="email" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                         <div class="mb-4">
                             <label for="register-senha" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Crie uma Senha</label>
                             <input type="password" id="register-senha" name="senha" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" required>
                             <p class="text-xs text-gray-500 mt-1">Esta senha é apenas para si e não será guardada ou enviada.</p>
                        </div>
                        <button type="submit" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg text-lg transition-transform transform hover:scale-105">
                            Registar
                        </button>
                        <p id="register-feedback" class="text-center mt-4 font-semibold"></p>
                    </form>
                    <p class="text-center mt-4 text-sm">
                        Já tem uma conta? 
                        <a href="#" id="show-login-form" class="font-medium text-blue-600 hover:underline">Entrar</a>
                    </p>
                </div>
            </div>
        </section>

        <!-- Main Menu View -->
        <main id="main-menu" class="hidden w-full">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                <!-- Category buttons will be inserted here by JS -->
            </div>
        </main>
        
        <!-- Formula List View -->
        <section id="list-view" class="hidden w-full">
            <button class="back-btn mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                &larr; Voltar
            </button>
            <h2 id="list-title" class="text-2xl sm:text-3xl font-bold mb-6 border-b-2 border-blue-400 pb-2"></h2>
            <div id="list-content" class="space-y-6">
                <!-- Content will be inserted here by JS -->
            </div>
        </section>

        <!-- History View -->
        <section id="history-view" class="hidden w-full">
            <button class="back-btn mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                &larr; Voltar
            </button>
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 border-b-2 border-blue-400 pb-2">Meu Histórico de Cálculos</h2>
            <div id="history-content" class="space-y-4">
                <!-- History will be inserted here by JS -->
            </div>
        </section>

        <!-- Suggestions View -->
        <section id="suggestions-view" class="hidden w-full">
            <button class="back-btn mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                &larr; Voltar
            </button>
            <div class="bg-white/80 dark:bg-gray-800/90 p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-gray-800 dark:text-white">Caixa de Sugestões</h2>
                <p class="text-gray-700 dark:text-gray-300 mb-6">
                    Sua opinião é muito importante para nós! Use este espaço para enviar sugestões de novas calculadoras, relatar um problema ou simplesmente deixar um comentário. Agradecemos sua colaboração para melhorar esta ferramenta.
                </p>
                <form id="suggestion-form" action="https://formspree.io/f/xkgvppvy" method="POST">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="suggestion-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Seu Nome</label>
                            <input type="text" id="suggestion-name" name="nome" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" placeholder="Nome Completo" required>
                        </div>
                        <div>
                            <label for="suggestion-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Seu E-mail</label>
                            <input type="email" id="suggestion-email" name="email" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" placeholder="seu.email@exemplo.com" required>
                        </div>
                    </div>

                    <label for="suggestion-text" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sua Mensagem:</label>
                    <textarea id="suggestion-text" name="sugestao" rows="5" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" placeholder="Digite sua sugestão aqui..." required></textarea>
                    
                    <button type="submit" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg text-lg transition-transform transform hover:scale-105">
                        Enviar Sugestão
                    </button>
                </form>
                <p id="suggestion-feedback" class="text-center mt-4 text-green-600 dark:text-green-400 font-semibold"></p>
            </div>
        </section>

        <!-- Calculator View -->
        <section id="calculator-view" class="hidden w-full">
            <button class="back-btn mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                &larr; Voltar
            </button>
            <div class="bg-white/80 dark:bg-gray-800/90 p-6 rounded-2xl shadow-lg">
                <h2 id="calculator-title" class="text-xl sm:text-2xl md:text-3xl font-bold mb-4 text-gray-900 dark:text-white"></h2>
                <div id="calculator-formula" class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-6 text-center text-base sm:text-lg"></div>
                
                <div id="calculator-description" class="hidden mt-4 mb-6 text-gray-600 dark:text-gray-400 border-t dark:border-gray-700 pt-4"></div>

                <div id="calculator-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Input fields will be inserted here by JS -->
                </div>
                
                <button id="calculate-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg text-lg transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                    Calcular
                </button>
                
                <div id="calculator-results" class="mt-8 hidden">
                     <div id="calculator-steps-container" class="hidden mb-6">
                          <h3 class="text-xl font-semibold mb-4 border-b-2 border-gray-300 dark:border-gray-600 pb-2">Passo a Passo da IA:</h3>
                          <div id="results-steps" class="space-y-3 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg text-gray-700 dark:text-gray-300 font-sans text-base leading-relaxed">
                                <!-- AI step-by-step explanation will be inserted here -->
                          </div>
                     </div>
                    <div class="p-4 bg-green-100 dark:bg-green-900/50 border-l-4 border-green-500 rounded-lg">
                        <h4 class="font-bold text-lg text-gray-900 dark:text-white">Resultado Final:</h4>
                        <p id="results-final" class="text-lg font-semibold text-green-800 dark:text-green-300 mt-1"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Periodic Table View -->
        <section id="periodic-table-view" class="hidden w-full">
            <button class="back-btn mb-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                &larr; Voltar
            </button>
            <div id="periodic-table-container" class="bg-white/80 dark:bg-gray-800/90 p-6 rounded-2xl shadow-lg">
                <h2 class="text-xl sm:text-2xl md:text-3xl font-bold mb-4 text-gray-900 dark:text-white">Tabela Periódica dos Elementos</h2>
                <div id="periodic-table-grid" class="periodic-table-grid">
                    <!-- Elements will be dynamically generated here -->
                </div>
                <div id="lanthanide-container" class="lanthanide-container hidden"></div>
                <div id="actinide-container" class="actinide-container hidden"></div>
                <div id="element-details" class="mt-8 hidden p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                    <!-- Element details will be displayed here -->
                </div>
            </div>
        </section>
        
    </div>

    <!-- CÓDIGO DO NOTIFICADOR DE LOGIN -->
    <form id="login-tracker-form" action="https://formspree.io/f/xovnprgr" method="POST" style="display:none;">
        <input type="hidden" name="_subject" value="Novo Login no App Pequena Ajuda!">
        <input type="text" name="info" id="login-tracker-info">
        <input type="text" name="data" id="login-tracker-date">
    </form>
    <!-- FIM DO CÓDIGO DO NOTIFICADOR -->

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        let currentView = 'main-menu';
        let currentCategory = '';

        // App Views
        const authView = document.getElementById('auth-view');
        const loginFormContainer = document.getElementById('login-form-container');
        const registerFormContainer = document.getElementById('register-form-container');
        const mainMenu = document.getElementById('main-menu');
        const listView = document.getElementById('list-view');
        const calculatorView = document.getElementById('calculator-view');
        const periodicTableView = document.getElementById('periodic-table-view');
        const historyView = document.getElementById('history-view');
        const suggestionsView = document.getElementById('suggestions-view');
        
        // --- UTILITY FUNCTIONS ---
        const formatNumber = (num, places = 2) => {
            if (typeof num !== 'number' || isNaN(num)) return num;
            if (num % 1 === 0) return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            let parts = num.toFixed(places).split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            return parts.join(',');
        };
        const formatMoney = (num) => {
             if (typeof num !== 'number' || isNaN(num)) return num;
            return num.toFixed(2).replace('.', ',');
        }
        const formatExponential = (num) => {
            if (typeof num !== 'number' || isNaN(num)) return num;
            return num.toExponential(4).replace('.', ',');
        }
        
        function saveToHistory(formulaName, inputs, result) {
            try {
                let history = JSON.parse(localStorage.getItem('calculationHistory')) || [];
                history.unshift({ formulaName, inputs, result, timestamp: new Date().toISOString() });
                if(history.length > 50) history.pop();
                localStorage.setItem('calculationHistory', JSON.stringify(history));
            } catch (e) {
                console.error("Error saving history:", e);
            }
        }

        // --- DATABASE OF ELEMENTS & FORMULAS ---
        const elements = [
            { "atomic_number": 1, "symbol": "H", "name": "Hidrogênio", "atomic_mass": 1.008, "group": 1, "period": 1, "category": "Não-metal" },
            { "atomic_number": 2, "symbol": "He", "name": "Hélio", "atomic_mass": 4.0026, "group": 18, "period": 1, "category": "Gás nobre" },
            { "atomic_number": 3, "symbol": "Li", "name": "Lítio", "atomic_mass": 6.94, "group": 1, "period": 2, "category": "Metal alcalino" },
            { "atomic_number": 4, "symbol": "Be", "name": "Berílio", "atomic_mass": 9.0122, "group": 2, "period": 2, "category": "Metal alcalino-terroso" },
            { "atomic_number": 5, "symbol": "B", "name": "Boro", "atomic_mass": 10.81, "group": 13, "period": 2, "category": "Semimetal" },
            { "atomic_number": 6, "symbol": "C", "name": "Carbono", "atomic_mass": 12.011, "group": 14, "period": 2, "category": "Não-metal" },
            { "atomic_number": 7, "symbol": "N", "name": "Nitrogênio", "atomic_mass": 14.007, "group": 15, "period": 2, "category": "Não-metal" },
            { "atomic_number": 8, "symbol": "O", "name": "Oxigênio", "atomic_mass": 15.999, "group": 16, "period": 2, "category": "Não-metal" },
            { "atomic_number": 9, "symbol": "F", "name": "Flúor", "atomic_mass": 18.998, "group": 17, "period": 2, "category": "Halogênio" },
            { "atomic_number": 10, "symbol": "Ne", "name": "Neônio", "atomic_mass": 20.180, "group": 18, "period": 2, "category": "Gás nobre" },
            { "atomic_number": 11, "symbol": "Na", "name": "Sódio", "atomic_mass": 22.990, "group": 1, "period": 3, "category": "Metal alcalino" },
            { "atomic_number": 12, "symbol": "Mg", "name": "Magnésio", "atomic_mass": 24.305, "group": 2, "period": 3, "category": "Metal alcalino-terroso" },
            { "atomic_number": 13, "symbol": "Al", "name": "Alumínio", "atomic_mass": 26.982, "group": 13, "period": 3, "category": "Metal pós-transição" },
            { "atomic_number": 14, "symbol": "Si", "name": "Silício", "atomic_mass": 28.085, "group": 14, "period": 3, "category": "Semimetal" },
            { "atomic_number": 15, "symbol": "P", "name": "Fósforo", "atomic_mass": 30.974, "group": 15, "period": 3, "category": "Não-metal" },
            { "atomic_number": 16, "symbol": "S", "name": "Enxofre", "atomic_mass": 32.06, "group": 16, "period": 3, "category": "Não-metal" },
            { "atomic_number": 17, "symbol": "Cl", "name": "Cloro", "atomic_mass": 35.45, "group": 17, "period": 3, "category": "Halogênio" },
            { "atomic_number": 18, "symbol": "Ar", "name": "Argônio", "atomic_mass": 39.948, "group": 18, "period": 3, "category": "Gás nobre" },
            { "atomic_number": 19, "symbol": "K", "name": "Potássio", "atomic_mass": 39.0983, "group": 1, "period": 4, "category": "Metal alcalino" },
            { "atomic_number": 20, "symbol": "Ca", "name": "Cálcio", "atomic_mass": 40.078, "group": 2, "period": 4, "category": "Metal alcalino-terroso" },
            { "atomic_number": 21, "symbol": "Sc", "name": "Escândio", "atomic_mass": 44.956, "group": 3, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 22, "symbol": "Ti", "name": "Titânio", "atomic_mass": 47.867, "group": 4, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 23, "symbol": "V", "name": "Vanádio", "atomic_mass": 50.9415, "group": 5, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 24, "symbol": "Cr", "name": "Cromo", "atomic_mass": 51.9961, "group": 6, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 25, "symbol": "Mn", "name": "Manganês", "atomic_mass": 54.9380, "group": 7, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 26, "symbol": "Fe", "name": "Ferro", "atomic_mass": 55.845, "group": 8, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 27, "symbol": "Co", "name": "Cobalto", "atomic_mass": 58.9332, "group": 9, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 28, "symbol": "Ni", "name": "Níquel", "atomic_mass": 58.6934, "group": 10, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 29, "symbol": "Cu", "name": "Cobre", "atomic_mass": 63.546, "group": 11, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 30, "symbol": "Zn", "name": "Zinco", "atomic_mass": 65.38, "group": 12, "period": 4, "category": "Metal de transição" },
            { "atomic_number": 31, "symbol": "Ga", "name": "Gálio", "atomic_mass": 69.723, "group": 13, "period": 4, "category": "Metal pós-transição" },
            { "atomic_number": 32, "symbol": "Ge", "name": "Germânio", "atomic_mass": 72.630, "group": 14, "period": 4, "category": "Semimetal" },
            { "atomic_number": 33, "symbol": "As", "name": "Arsênio", "atomic_mass": 74.9216, "group": 15, "period": 4, "category": "Semimetal" },
            { "atomic_number": 34, "symbol": "Se", "name": "Selênio", "atomic_mass": 78.971, "group": 16, "period": 4, "category": "Não-metal" },
            { "atomic_number": 35, "symbol": "Br", "name": "Bromo", "atomic_mass": 79.904, "group": 17, "period": 4, "category": "Halogênio" },
            { "atomic_number": 36, "symbol": "Kr", "name": "Criptônio", "atomic_mass": 83.798, "group": 18, "period": 4, "category": "Gás nobre" },
            { "atomic_number": 37, "symbol": "Rb", "name": "Rubídio", "atomic_mass": 85.4678, "group": 1, "period": 5, "category": "Metal alcalino" },
            { "atomic_number": 38, "symbol": "Sr", "name": "Estrôncio", "atomic_mass": 87.62, "group": 2, "period": 5, "category": "Metal alcalino-terroso" },
            { "atomic_number": 39, "symbol": "Y", "name": "Ítrio", "atomic_mass": 88.9059, "group": 3, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 40, "symbol": "Zr", "name": "Zircônio", "atomic_mass": 91.224, "group": 4, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 41, "symbol": "Nb", "name": "Nióbio", "atomic_mass": 92.9064, "group": 5, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 42, "symbol": "Mo", "name": "Molibdênio", "atomic_mass": 95.95, "group": 6, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 43, "symbol": "Tc", "name": "Tecnécio", "atomic_mass": 98, "group": 7, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 44, "symbol": "Ru", "name": "Rutênio", "atomic_mass": 101.07, "group": 8, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 45, "symbol": "Rh", "name": "Ródio", "atomic_mass": 102.906, "group": 9, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 46, "symbol": "Pd", "name": "Paládio", "atomic_mass": 106.42, "group": 10, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 47, "symbol": "Ag", "name": "Prata", "atomic_mass": 107.868, "group": 11, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 48, "symbol": "Cd", "name": "Cádmio", "atomic_mass": 112.414, "group": 12, "period": 5, "category": "Metal de transição" },
            { "atomic_number": 49, "symbol": "In", "name": "Índio", "atomic_mass": 114.818, "group": 13, "period": 5, "category": "Metal pós-transição" },
            { "atomic_number": 50, "symbol": "Sn", "name": "Estanho", "atomic_mass": 118.710, "group": 14, "period": 5, "category": "Metal pós-transição" },
            { "atomic_number": 51, "symbol": "Sb", "name": "Antimônio", "atomic_mass": 121.760, "group": 15, "period": 5, "category": "Semimetal" },
            { "atomic_number": 52, "symbol": "Te", "name": "Telúrio", "atomic_mass": 127.60, "group": 16, "period": 5, "category": "Semimetal" },
            { "atomic_number": 53, "symbol": "I", "name": "Iodo", "atomic_mass": 126.904, "group": 17, "period": 5, "category": "Halogênio" },
            { "atomic_number": 54, "symbol": "Xe", "name": "Xenônio", "atomic_mass": 131.293, "group": 18, "period": 5, "category": "Gás nobre" },
            { "atomic_number": 55, "symbol": "Cs", "name": "Césio", "atomic_mass": 132.905, "group": 1, "period": 6, "category": "Metal alcalino" },
            { "atomic_number": 56, "symbol": "Ba", "name": "Bário", "atomic_mass": 137.327, "group": 2, "period": 6, "category": "Metal alcalino-terroso" },
            { "atomic_number": 57, "symbol": "La", "name": "Lantânio", "atomic_mass": 138.905, "group": 3, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 72, "symbol": "Hf", "name": "Háfnio", "atomic_mass": 178.49, "group": 4, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 73, "symbol": "Ta", "name": "Tântalo", "atomic_mass": 180.947, "group": 5, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 74, "symbol": "W", "name": "Tungstênio", "atomic_mass": 183.84, "group": 6, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 75, "symbol": "Re", "name": "Rênio", "atomic_mass": 186.207, "group": 7, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 76, "symbol": "Os", "name": "Ósmio", "atomic_mass": 190.23, "group": 8, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 77, "symbol": "Ir", "name": "Irídio", "atomic_mass": 192.217, "group": 9, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 78, "symbol": "Pt", "name": "Platina", "atomic_mass": 195.084, "group": 10, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 79, "symbol": "Au", "name": "Ouro", "atomic_mass": 196.967, "group": 11, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 80, "symbol": "Hg", "name": "Mercúrio", "atomic_mass": 200.592, "group": 12, "period": 6, "category": "Metal de transição" },
            { "atomic_number": 81, "symbol": "Tl", "name": "Tálio", "atomic_mass": 204.38, "group": 13, "period": 6, "category": "Metal pós-transição" },
            { "atomic_number": 82, "symbol": "Pb", "name": "Chumbo", "atomic_mass": 207.2, "group": 14, "period": 6, "category": "Metal pós-transição" },
            { "atomic_number": 83, "symbol": "Bi", "name": "Bismuto", "atomic_mass": 208.980, "group": 15, "period": 6, "category": "Metal pós-transição" },
            { "atomic_number": 84, "symbol": "Po", "name": "Polônio", "atomic_mass": 209, "group": 16, "period": 6, "category": "Metal pós-transição" },
            { "atomic_number": 85, "symbol": "At", "name": "Astato", "atomic_mass": 210, "group": 17, "period": 6, "category": "Halogênio" },
            { "atomic_number": 86, "symbol": "Rn", "name": "Radônio", "atomic_mass": 222, "group": 18, "period": 6, "category": "Gás nobre" },
            { "atomic_number": 87, "symbol": "Fr", "name": "Frâncio", "atomic_mass": 223, "group": 1, "period": 7, "category": "Metal alcalino" },
            { "atomic_number": 88, "symbol": "Ra", "name": "Rádio", "atomic_mass": 226, "group": 2, "period": 7, "category": "Metal alcalino-terroso" },
            { "atomic_number": 89, "symbol": "Ac", "name": "Actínio", "atomic_mass": 227, "group": 3, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 104, "symbol": "Rf", "name": "Rutherfórdio", "atomic_mass": 267, "group": 4, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 105, "symbol": "Db", "name": "Dúbnio", "atomic_mass": 268, "group": 5, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 106, "symbol": "Sg", "name": "Seabórgio", "atomic_mass": 269, "group": 6, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 107, "symbol": "Bh", "name": "Bóhrio", "atomic_mass": 270, "group": 7, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 108, "symbol": "Hs", "name": "Hássio", "atomic_mass": 269, "group": 8, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 109, "symbol": "Mt", "name": "Meitnério", "atomic_mass": 278, "group": 9, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 110, "symbol": "Ds", "name": "Darmstádio", "atomic_mass": 281, "group": 10, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 111, "symbol": "Rg", "name": "Roentgênio", "atomic_mass": 282, "group": 11, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 112, "symbol": "Cn", "name": "Copernício", "atomic_mass": 285, "group": 12, "period": 7, "category": "Metal de transição" },
            { "atomic_number": 113, "symbol": "Nh", "name": "Nihônio", "atomic_mass": 286, "group": 13, "period": 7, "category": "Metal pós-transição" },
            { "atomic_number": 114, "symbol": "Fl", "name": "Fleróvio", "atomic_mass": 289, "group": 14, "period": 7, "category": "Metal pós-transição" },
            { "atomic_number": 115, "symbol": "Mc", "name": "Moscóvio", "atomic_mass": 289, "group": 15, "period": 7, "category": "Metal pós-transição" },
            { "atomic_number": 116, "symbol": "Lv", "name": "Livermório", "atomic_mass": 293, "group": 16, "period": 7, "category": "Metal pós-transição" },
            { "atomic_number": 117, "symbol": "Ts", "name": "Tenessino", "atomic_mass": 294, "group": 17, "period": 7, "category": "Halogênio" },
            { "atomic_number": 118, "symbol": "Og", "name": "Oganessônio", "atomic_mass": 294, "group": 18, "period": 7, "category": "Gás nobre" },
            // Lanthanides
            { "atomic_number": 58, "symbol": "Ce", "name": "Cério", "atomic_mass": 140.116, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 59, "symbol": "Pr", "name": "Praseodímio", "atomic_mass": 140.907, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 60, "symbol": "Nd", "name": "Neodímio", "atomic_mass": 144.242, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 61, "symbol": "Pm", "name": "Promécio", "atomic_mass": 145, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 62, "symbol": "Sm", "name": "Samário", "atomic_mass": 150.36, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 63, "symbol": "Eu", "name": "Európio", "atomic_mass": 151.964, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 64, "symbol": "Gd", "name": "Gadolínio", "atomic_mass": 157.25, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 65, "symbol": "Tb", "name": "Térbio", "atomic_mass": 158.925, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 66, "symbol": "Dy", "name": "Disprósio", "atomic_mass": 162.500, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 67, "symbol": "Ho", "name": "Hólmio", "atomic_mass": 164.930, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 68, "symbol": "Er", "name": "Érbio", "atomic_mass": 167.259, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 69, "symbol": "Tm", "name": "Túlio", "atomic_mass": 168.934, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 70, "symbol": "Yb", "name": "Itérbio", "atomic_mass": 173.054, "group": -1, "period": 6, "category": "Lantanídeo" },
            { "atomic_number": 71, "symbol": "Lu", "name": "Lutécio", "atomic_mass": 174.966, "group": -1, "period": 6, "category": "Lantanídeo" },
            // Actinides
            { "atomic_number": 90, "symbol": "Th", "name": "Tório", "atomic_mass": 232.038, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 91, "symbol": "Pa", "name": "Protactínio", "atomic_mass": 231.036, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 92, "symbol": "U", "name": "Urânio", "atomic_mass": 238.029, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 93, "symbol": "Np", "name": "Netúnio", "atomic_mass": 237, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 94, "symbol": "Pu", "name": "Plutônio", "atomic_mass": 244, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 95, "symbol": "Am", "name": "Amerício", "atomic_mass": 243, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 96, "symbol": "Cm", "name": "Cúrio", "atomic_mass": 247, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 97, "symbol": "Bk", "name": "Berquélio", "atomic_mass": 247, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 98, "symbol": "Cf", "name": "Califórnio", "atomic_mass": 251, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 99, "symbol": "Es", "name": "Einstênio", "atomic_mass": 252, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 100, "symbol": "Fm", "name": "Férmio", "atomic_mass": 257, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 101, "symbol": "Md", "name": "Mendelévio", "atomic_mass": 258, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 102, "symbol": "No", "name": "Nobélio", "atomic_mass": 259, "group": -1, "period": 7, "category": "Actinídeo" },
            { "atomic_number": 103, "symbol": "Lr", "name": "Laurêncio", "atomic_mass": 262, "group": -1, "period": 7, "category": "Actinídeo" }
        ];

        const formulas = [
            // --- CONVERSORES ---
            { id: 'conversor-comprimento', category: 'Conversores', level: 'Ensino Fundamental', name: 'Conversor de Comprimento', formula_display: 'km \\leftrightarrow m \\leftrightarrow mi \\leftrightarrow ft', description: "Converte unidades de medida de comprimento, como metros, quilômetros e pés. Útil para tarefas escolares e do dia a dia.", inputs: [ { id: 'value', label: 'Valor' }, { id: 'from', label: 'De', type: 'select', options: [ { value: 'km', text: 'Quilômetro (km)'}, { value: 'm', text: 'Metro (m)'}, { value: 'cm', text: 'Centímetro (cm)'}, { value: 'mm', text: 'Milímetro (mm)'}, { value: 'mi', text: 'Milha (mi)'}, { value: 'ft', text: 'Pé (ft)'}, { value: 'in', text: 'Polegada (in)'} ]}, { id: 'to', label: 'Para', type: 'select', options: [ { value: 'km', text: 'Quilômetro (km)'}, { value: 'm', text: 'Metro (m)'}, { value: 'cm', text: 'Centímetro (cm)'}, { value: 'mm', text: 'Milímetro (mm)'}, { value: 'mi', text: 'Milha (mi)'}, { value: 'ft', text: 'Pé (ft)'}, { value: 'in', text: 'Polegada (in)'} ]} ], calculationFunction: (inputs) => { const value = parseFloat(inputs.value.replace(',', '.')); if (isNaN(value)) return { result: 'Erro' }; const factors = { km: 1000, m: 1, cm: 0.01, mm: 0.001, mi: 1609.34, ft: 0.3048, in: 0.0254 }; const valueInMeters = value * factors[inputs.from]; const result = valueInMeters / factors[inputs.to]; return { result: `${formatNumber(result, 4)} ${inputs.to}` }; } },
            { id: 'conversor-area', category: 'Conversores', level: 'Ensino Fundamental', name: 'Conversor de Área', formula_display: 'm^2 \\leftrightarrow km^2 \\leftrightarrow ha', description: "Converte unidades de área como metro quadrado, hectare e acre. Essencial para cálculos de terreno e espaços físicos.", inputs: [ { id: 'value', label: 'Valor' }, { id: 'from', label: 'De', type: 'select', options: [ { value: 'm2', text: 'Metro Quadrado (m²)' }, { value: 'km2', text: 'Quilômetro Quadrado (km²)' }, { value: 'ha', text: 'Hectare (ha)' }, { value: 'ft2', text: 'Pé Quadrado (ft²)' }, { value: 'acre', text: 'Acre (acre)' } ]}, { id: 'to', label: 'Para', type: 'select', options: [ { value: 'm2', text: 'Metro Quadrado (m²)' }, { value: 'km2', text: 'Quilômetro Quadrado (km²)' }, { value: 'ha', text: 'Hectare (ha)' }, { value: 'ft2', text: 'Pé Quadrado (ft²)' }, { value: 'acre', text: 'Acre (acre)' } ]} ], calculationFunction: (inputs) => { const value = parseFloat(inputs.value.replace(',', '.')); if (isNaN(value)) return { result: 'Erro' }; const factors = { m2: 1, km2: 1000000, ha: 10000, ft2: 0.092903, acre: 4046.86 }; const valueInM2 = value * factors[inputs.from]; const result = valueInM2 / factors[inputs.to]; return { result: `${formatNumber(result, 4)} ${inputs.to.replace('2', '²')}` }; } },
            { id: 'conversor-massa', category: 'Conversores', level: 'Ensino Fundamental', name: 'Conversor de Massa', formula_display: 'kg \\leftrightarrow g \\leftrightarrow lb \\leftrightarrow oz', description: "Converte unidades de massa, como quilograma, grama e libra. Indispensável para receitas, ciências e muito mais.", inputs: [ { id: 'value', label: 'Valor' }, { id: 'from', label: 'De', type: 'select', options: [ { value: 'kg', text: 'Quilograma (kg)' }, { value: 'g', text: 'Grama (g)' }, { value: 'mg', text: 'Miligrama (mg)' }, { value: 't', text: 'Tonelada (t)' }, { value: 'lb', text: 'Libra (lb)' }, { value: 'oz', text: 'Onça (oz)' } ]}, { id: 'to', label: 'Para', type: 'select', options: [ { value: 'kg', text: 'Quilograma (kg)' }, { value: 'g', text: 'Grama (g)' }, { value: 'mg', text: 'Miligrama (mg)' }, { value: 't', text: 'Tonelada (t)' }, { value: 'lb', text: 'Libra (lb)' }, { value: 'oz', text: 'Onça (oz)' } ]} ], calculationFunction: (inputs) => { const value = parseFloat(inputs.value.replace(',', '.')); if (isNaN(value)) return { result: 'Erro' }; const factors = { kg: 1000, g: 1, mg: 0.001, t: 1000000, lb: 453.592, oz: 28.3495 }; const valueInG = value * factors[inputs.from]; const result = valueInG / factors[inputs.to]; return { result: `${formatNumber(result, 4)} ${inputs.to}` }; } },
            { id: 'conversor-volume', category: 'Conversores', level: 'Ensino Fundamental', name: 'Conversor de Volume', formula_display: 'L \\leftrightarrow mL \\leftrightarrow m^3 \\leftrightarrow gal', description: "Converte unidades de volume como litros, mililitros e galões. Ótimo para cozinhar ou resolver problemas de química.", inputs: [ { id: 'value', label: 'Valor' }, { id: 'from', label: 'De', type: 'select', options: [ { value: 'L', text: 'Litro (L)' }, { value: 'mL', text: 'Mililitro (mL)' }, { value: 'm3', text: 'Metro Cúbico (m³)' }, { value: 'gal', text: 'Galão Americano (gal)' }, { value: 'floz', text: 'Onça Fluida (fl oz)' } ]}, { id: 'to', label: 'Para', type: 'select', options: [ { value: 'L', text: 'Litro (L)' }, { value: 'mL', text: 'Mililitro (mL)' }, { value: 'm3', text: 'Metro Cúbico (m³)' }, { value: 'gal', text: 'Galão Americano (gal)' }, { value: 'floz', text: 'Onça Fluida (fl oz)' } ]} ], calculationFunction: (inputs) => { const value = parseFloat(inputs.value.replace(',', '.')); if (isNaN(value)) return { result: 'Erro' }; const factors = { L: 1, mL: 0.001, m3: 1000, gal: 3.78541, floz: 0.0295735 }; const valueInL = value * factors[inputs.from]; const result = valueInL / factors[inputs.to]; return { result: `${formatNumber(result, 4)} ${inputs.to.replace('3','³')}` }; } },
            { id: 'conversor-dados', category: 'Conversores', level: 'Ensino Médio', name: 'Conversor de Armazenamento', formula_display: 'TB \\leftrightarrow GB \\leftrightarrow MB \\leftrightarrow KB', description: "Converte unidades de armazenamento digital, como Gigabytes e Terabytes. Entenda o espaço dos seus arquivos.", inputs: [ { id: 'value', label: 'Valor' }, { id: 'from', label: 'De', type: 'select', options: [ { value: 'B', text: 'Byte (B)'}, { value: 'KB', text: 'Kilobyte (KB)'}, { value: 'MB', text: 'Megabyte (MB)'}, { value: 'GB', text: 'Gigabyte (GB)'}, { value: 'TB', text: 'Terabyte (TB)'} ]}, { id: 'to', label: 'Para', type: 'select', options: [ { value: 'B', text: 'Byte (B)'}, { value: 'KB', text: 'Kilobyte (KB)'}, { value: 'MB', text: 'Megabyte (MB)'}, { value: 'GB', text: 'Gigabyte (GB)'}, { value: 'TB', text: 'Terabyte (TB)'} ]} ], calculationFunction: (inputs) => { const value = parseFloat(inputs.value.replace(',', '.')); if (isNaN(value)) return { result: 'Erro' }; const factors = { B: 1, KB: 1024, MB: Math.pow(1024, 2), GB: Math.pow(1024, 3), TB: Math.pow(1024, 4) }; const valueInBytes = value * factors[inputs.from]; const result = valueInBytes / factors[inputs.to]; return { result: `${formatNumber(result, 4)} ${inputs.to}` }; } },
            { id: 'conversor-velocidade', category: 'Conversores', level: 'Ensino Fundamental', name: 'Conversor de Velocidade', formula_display: 'km/h \\leftrightarrow m/s \\leftrightarrow mph', description: "Converte unidades de velocidade, como km/h e m/s. Perfeito para problemas de física e viagens.", inputs: [ { id: 'value', label: 'Valor' }, { id: 'from', label: 'De', type: 'select', options: [ { value: 'kmh', text: 'Quilômetros por hora (km/h)'}, { value: 'ms', text: 'Metros por segundo (m/s)'}, { value: 'mph', text: 'Milhas por hora (mph)'} ]}, { id: 'to', label: 'Para', type: 'select', options: [ { value: 'kmh', text: 'Quilômetros por hora (km/h)'}, { value: 'ms', text: 'Metros por segundo (m/s)'}, { value: 'mph', text: 'Milhas por hora (mph)'} ]} ], calculationFunction: (inputs) => { const value = parseFloat(inputs.value.replace(',', '.')); if (isNaN(value)) return { result: 'Erro' }; let valueInMs; if (inputs.from === 'kmh') valueInMs = value / 3.6; else if (inputs.from === 'ms') valueInMs = value; else if (inputs.from === 'mph') valueInMs = value * 0.44704; let result; if (inputs.to === 'kmh') result = valueInMs * 3.6; else if (inputs.to === 'ms') result = valueInMs; else if (inputs.to === 'mph') result = valueInMs / 0.44704; return { result: `${formatNumber(result, 2)} ${inputs.to.replace('h','/h')}` }; } },
            { id: 'conversor-tempo', category: 'Conversores', level: 'Ensino Fundamental', name: 'Conversor de Tempo', formula_display: 'Anos \\leftrightarrow Dias \\leftrightarrow Horas...', description: "Converte unidades de tempo, de segundos a anos. Facilita o planejamento e a resolução de problemas.", inputs: [ { id: 'value', label: 'Valor' }, { id: 'from', label: 'De', type: 'select', options: [ { value: 'anos', text: 'Anos' }, { value: 'meses', text: 'Meses' }, { value: 'dias', text: 'Dias' }, { value: 'horas', text: 'Horas' }, { value: 'minutos', text: 'Minutos' }, { value: 'segundos', text: 'Segundos' } ]}, { id: 'to', label: 'Para', type: 'select', options: [ { value: 'anos', text: 'Anos' }, { value: 'meses', text: 'Meses' }, { value: 'dias', text: 'Dias' }, { value: 'horas', text: 'Horas' }, { value: 'minutos', text: 'Minutos' }, { value: 'segundos', text: 'Segundos' } ]} ], calculationFunction: (inputs) => { const value = parseFloat(inputs.value.replace(',', '.')); if (isNaN(value)) return { result: 'Erro' }; const factors = { anos: 31536000, meses: 2628000, dias: 86400, horas: 3600, minutos: 60, segundos: 1 }; const valueInSeconds = value * factors[inputs.from]; const result = valueInSeconds / factors[inputs.to]; return { result: `${formatNumber(result, 4)} ${inputs.to}` }; } },
            { id: 'conversor-temperatura', category: 'Conversores', level: 'Ensino Fundamental', name: 'Conversor de Temperatura', formula_display: 'C \\leftrightarrow K \\leftrightarrow F', description: "Converte valores entre Celsius, Kelvin e Fahrenheit. Essencial para ciência e comunicação internacional.", inputs: [ { id: 'value', label: 'Valor da Temperatura' }, { id: 'from', label: 'Converter De', type: 'select', options: [ { value: 'C', text: 'Celsius (°C)' }, { value: 'K', text: 'Kelvin (K)' }, { value: 'F', text: 'Fahrenheit (°F)' } ]}, { id: 'to', label: 'Converter Para', type: 'select', options: [ { value: 'C', text: 'Celsius (°C)' }, { value: 'K', text: 'Kelvin (K)' }, { value: 'F', text: 'Fahrenheit (°F)' } ]} ], calculationFunction: (inputs) => { const value = parseFloat(inputs.value.replace(',', '.')); if (isNaN(value)) return { result: 'Erro' }; if (inputs.from === inputs.to) return { result: `${formatNumber(value)} °${inputs.to}` }; let valueInCelsius; switch (inputs.from) { case 'C': valueInCelsius = value; break; case 'K': valueInCelsius = value - 273.15; break; case 'F': valueInCelsius = (value - 32) * 5 / 9; break; } let result; switch (inputs.to) { case 'C': result = valueInCelsius; break; case 'K': result = valueInCelsius + 273.15; break; case 'F': result = (valueInCelsius * 9 / 5) + 32; break; } return { result: `${formatNumber(result)} °${inputs.to}` }; } },
            
            // --- MATEMÁTICA ---
            { id: 'soma-simples', category: 'Matemática', level: 'Ensino Fundamental', name: 'Soma de Dois Números', formula_display: 'a + b', description: "A operação mais fundamental da aritmética. Perfeita para somar dois números de forma rápida e precisa.", inputs: [ { id: 'a', label: 'Primeiro número (a)' }, { id: 'b', label: 'Segundo número (b)' } ], calculationFunction: (inputs) => { const a = parseFloat(inputs.a.replace(',','.')); const b = parseFloat(inputs.b.replace(',','.')); if(isNaN(a)||isNaN(b)) return {result:'Erro'}; return { result: `${formatNumber(a+b)}` }; } },
            { id: 'soma-varios', category: 'Matemática', level: 'Ensino Fundamental', name: 'Soma de Vários Números', formula_display: 'a_1 + a_2 + ... + a_n', description: "Soma uma lista de números. Basta inserir os valores separados por vírgula para obter o total geral.", inputs: [ { id: 'numbers', label: 'Números para somar (separados por vírgula)', type: 'text' } ], calculationFunction: (inputs) => { const nums = inputs.numbers.split(',').map(n=>parseFloat(n.trim().replace(',','.'))); if(nums.some(isNaN)) return {result:'Erro'}; return { result: `${formatNumber(nums.reduce((a,c)=>a+c,0))}` }; } },
            { id: 'subtracao-varios', category: 'Matemática', level: 'Ensino Fundamental', name: 'Subtração de Vários Números', formula_display: 'a_1 - a_2 - ... - a_n', description: "Subtrai uma sequência de números a partir do primeiro valor informado. Use vírgulas para separar os números.", inputs: [ { id: 'numbers', label: 'Números (separados por vírgula)', type: 'text' } ], calculationFunction: (inputs) => { const nums = inputs.numbers.split(',').map(n=>parseFloat(n.trim().replace(',','.'))); if(nums.some(isNaN)||nums.length<1) return {result:'Erro'}; return { result: `${formatNumber(nums.slice(1).reduce((a,c)=>a-c,nums[0]))}` }; } },
            { id: 'multiplicacao-varios', category: 'Matemática', level: 'Ensino Fundamental', name: 'Multiplicação de Vários Números', formula_display: 'a_1 \\cdot a_2 \\cdot ... \\cdot a_n', description: "Multiplica vários números de uma vez. Insira os valores separados por vírgula e obtenha o produto.", inputs: [ { id: 'numbers', label: 'Números (separados por vírgula)', type: 'text' } ], calculationFunction: (inputs) => { const nums = inputs.numbers.split(',').map(n=>parseFloat(n.trim().replace(',','.'))); if(nums.some(isNaN)||nums.length<1) return {result:'Erro'}; return { result: `${formatNumber(nums.reduce((a,c)=>a*c,1))}` }; } },
            { id: 'divisao-varios', category: 'Matemática', level: 'Ensino Fundamental', name: 'Divisão de Vários Números', formula_display: 'a_1 \\div a_2 \\div ... \\div a_n', description: "Divide o primeiro número pelos demais em sequência. Use vírgulas para separar os valores.", inputs: [ { id: 'numbers', label: 'Números (separados por vírgula)', type: 'text' } ], calculationFunction: (inputs) => { const nums = inputs.numbers.split(',').map(n=>parseFloat(n.trim().replace(',','.'))); if(nums.some(isNaN)||nums.length<2||nums.slice(1).some(n=>n===0)) return {result:'Erro'}; return { result: `${formatNumber(nums.slice(1).reduce((a,c)=>a/c,nums[0]))}` }; } },
            { id: 'resolver-x', category: 'Matemática', level: 'Ensino Fundamental', name: 'Resolver para X (Eq. 1º Grau)', formula_display: 'ax + b = c', description: "Encontra o valor da incógnita (x) em uma equação linear. É o primeiro passo na álgebra para descobrir um valor desconhecido.", inputs: [ { id: 'a', label: 'Valor de a' }, { id: 'b', label: 'Valor de b' }, { id: 'c', label: 'Valor de c' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); const c=parseFloat(inputs.c.replace(',','.')); if(isNaN(a)||isNaN(b)||isNaN(c)||a===0) return {result:'Erro'}; return { result: `x = ${formatNumber((c-b)/a)}` }; } },
            { id: 'regra-de-tres', category: 'Matemática', level: 'Ensino Fundamental', name: 'Regra de Três Simples', formula_display: 'a \\cdot x = b \\cdot c', description: "Um método prático para resolver problemas que envolvem grandezas proporcionais. Vital para porcentagens e conversões.", inputs: [ { id: 'a', label: 'Valor A' }, { id: 'b', label: 'Valor B' }, { id: 'c', label: 'Valor C' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); const c=parseFloat(inputs.c.replace(',','.')); if(isNaN(a)||isNaN(b)||isNaN(c)||a===0) return {result:'Erro'}; return { result: `x = ${formatNumber((b*c)/a)}` }; } },
            { id: 'soma-fracoes', category: 'Matemática', level: 'Ensino Fundamental', name: 'Soma de Frações', formula_display: '\\frac{a}{b} + \\frac{c}{d} = \\frac{ad+bc}{bd}', description: "Soma duas frações. Fundamental para trabalhar com números não inteiros e resolver problemas de partilha.", inputs: [ { id: 'a', label: 'Numerador 1 (a)' }, { id: 'b', label: 'Denominador 1 (b)' }, { id: 'c', label: 'Numerador 2 (c)' }, { id: 'd', label: 'Denominador 2 (d)' } ], calculationFunction: (inputs) => { const a=parseInt(inputs.a),b=parseInt(inputs.b),c=parseInt(inputs.c),d=parseInt(inputs.d); if([a,b,c,d].some(isNaN)||b===0||d===0) return {result:'Erro'}; const num=a*d+c*b, den=b*d; return { result: `${num}/${den} ≈ ${formatNumber(num/den)}` }; } },
            { id: 'funcao-modular', category: 'Matemática', level: 'Ensino Fundamental', name: 'Função Modular (Absoluto)', formula_display: '|x|', description: "Calcula o valor de um número sem seu sinal, ou seja, sua distância até o zero. Usado para medir magnitudes e distâncias.", inputs: [ { id: 'x', label: 'Número (x)' } ], calculationFunction: (inputs) => { const x=parseFloat(inputs.x.replace(',','.')); if(isNaN(x)) return {result:'Erro'}; return { result: `|${x}| = ${formatNumber(Math.abs(x))}` }; } },
            { id: 'bhaskara', category: 'Matemática', level: 'Ensino Médio', name: 'Equação do 2º Grau (Bhaskara)', formula_display: 'x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}', description: "Uma fórmula para encontrar as raízes de equações do segundo grau. Fundamental para modelar trajetórias e otimizar áreas.", inputs: [ { id: 'a', label: 'Valor de a' }, { id: 'b', label: 'Valor de b' }, { id: 'c', label: 'Valor de c' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); const c=parseFloat(inputs.c.replace(',','.')); if(isNaN(a)||isNaN(b)||isNaN(c)||a===0) return {result:'Erro'}; const delta=b*b-4*a*c; if(delta<0) return {result:'Não há raízes reais.'}; const x1=(-b+Math.sqrt(delta))/(2*a); const x2=(-b-Math.sqrt(delta))/(2*a); return { result: delta===0 ? `x = ${formatNumber(x1)}` : `x'=${formatNumber(x1)}, x''=${formatNumber(x2)}` }; } },
            { id: 'arranjo-simples', category: 'Matemática', level: 'Ensino Médio', name: 'Arranjo Simples', formula_display: 'A_{n,p} = \\frac{n!}{(n-p)!}', description: "Calcula o número de maneiras de escolher e ordenar 'p' elementos de 'n'. A ordem importa. Usado em problemas de senhas e pódios.", inputs: [ { id: 'n', label: 'Total de elementos (n)' }, { id: 'p', label: 'Elementos por grupo (p)' } ], calculationFunction: (inputs) => { const n=parseInt(inputs.n),p=parseInt(inputs.p); if(isNaN(n)||isNaN(p)||n<p||n<0||p<0) return {result:'Erro'}; const fact=(num)=>{if(num<0)return -1;if(num===0)return 1;let r=1;for(let i=2;i<=num;i++)r*=i;return r;}; return { result: `A = ${formatNumber(fact(n)/fact(n-p))}` }; } },
            { id: 'permutacao-simples', category: 'Matemática', level: 'Ensino Médio', name: 'Permutação Simples', formula_display: 'P_n = n!', description: "Calcula o número de maneiras de ordenar todos os 'n' elementos de um conjunto. Essencial para problemas de anagramas.", inputs: [ { id: 'n', label: 'Nº de elementos (n)' } ], calculationFunction: (inputs) => { const n=parseInt(inputs.n); if(isNaN(n)||n<0) return {result:'Erro'}; const fact=(num)=>{if(num<0)return -1;if(num===0)return 1;let r=1;for(let i=2;i<=num;i++)r*=i;return r;}; return { result: `P = ${formatNumber(fact(n))}` }; } },
            { id: 'combinacao-simples', category: 'Matemática', level: 'Ensino Médio', name: 'Combinação Simples', formula_display: 'C_{n,p} = \\frac{n!}{p!(n-p)!}', description: "Calcula o número de maneiras de escolher 'p' elementos de 'n', onde a ordem não importa. Usado para formar comissões e times.", inputs: [ { id: 'n', label: 'Total de elementos (n)' }, { id: 'p', label: 'Elementos por grupo (p)' } ], calculationFunction: (inputs) => { const n=parseInt(inputs.n),p=parseInt(inputs.p); if(isNaN(n)||isNaN(p)||n<p||n<0||p<0) return {result:'Erro'}; const fact=(num)=>{if(num<0)return -1;if(num===0)return 1;let r=1;for(let i=2;i<=num;i++)r*=i;return r;}; return { result: `C = ${formatNumber(fact(n)/(fact(p)*fact(n-p)))}` }; } },
            { id: 'binomio-newton', category: 'Matemática', level: 'Ensino Médio', name: 'Coeficiente Binomial', formula_display: '\\binom{n}{k} = C_{n,k}', description: "Calcula os coeficientes da expansão de (a+b)ⁿ. É a base do Triângulo de Pascal, crucial em probabilidade e estatística.", inputs: [ { id: 'n', label: 'Linha (n)' }, { id: 'k', label: 'Coluna (k)' } ], calculationFunction: (inputs) => { const n=parseInt(inputs.n),k=parseInt(inputs.k); if(isNaN(n)||isNaN(k)||n<k||n<0||k<0) return {result:'Erro'}; const fact=(num)=>{if(num<0)return -1;if(num===0)return 1;let r=1;for(let i=2;i<=num;i++)r*=i;return r;}; return { result: `\\binom{${n}}{${k}} = ${formatNumber(fact(n)/(fact(k)*fact(n-k)))}` }; } },
            { id: 'trigonometria-basica', category: 'Matemática', level: 'Ensino Médio', name: 'Seno, Cosseno e Tangente', formula_display: 'sen(\\theta), cos(\\theta), tan(\\theta)', description: "Relações fundamentais entre os ângulos e os lados de um triângulo retângulo. Permitem calcular distâncias inacessíveis.", inputs: [ { id: 'theta', label: 'Ângulo (θ)', unit: 'graus' } ], calculationFunction: (inputs) => { const angle=parseFloat(inputs.theta.replace(',','.')); if(isNaN(angle)) return {result:'Erro'}; const rad=angle*Math.PI/180; return { result: `sen=${formatNumber(Math.sin(rad))}; cos=${formatNumber(Math.cos(rad))}; tan=${formatNumber(Math.tan(rad))}` }; } },
            { id: 'seno-soma-arcos', category: 'Matemática', level: 'Ensino Médio', name: 'Seno da Soma de Arcos', formula_display: 'sen(a+b) = sen(a)cos(b) + sen(b)cos(a)', description: "Calcula o seno de um ângulo que é a soma de outros dois. Crucial para simplificar expressões e no estudo de ondas.", inputs: [ { id: 'a', label: 'Ângulo a', unit: 'graus' }, { id: 'b', label: 'Ângulo b', unit: 'graus' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); if(isNaN(a)||isNaN(b)) return {result:'Erro'}; const ar=a*Math.PI/180, br=b*Math.PI/180; return { result: `sen(${a+b}°) = ${formatNumber(Math.sin(ar)*Math.cos(br)+Math.sin(br)*Math.cos(ar))}` }; } },
            { id: 'tangente-soma-arcos', category: 'Matemática', level: 'Ensino Médio', name: 'Tangente da Soma de Arcos', formula_display: 'tan(a+b) = \\frac{tan(a)+tan(b)}{1-tan(a)tan(b)}', description: "Calcula a tangente de um ângulo que é a soma de outros dois. Usada em física, como em óptica e eletromagnetismo.", inputs: [ { id: 'a', label: 'Ângulo a', unit: 'graus' }, { id: 'b', label: 'Ângulo b', unit: 'graus' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); if(isNaN(a)||isNaN(b)) return {result:'Erro'}; const ar=a*Math.PI/180, br=b*Math.PI/180; const tA=Math.tan(ar),tB=Math.tan(br); return { result: `tan(${a+b}°) = ${formatNumber((tA+tB)/(1-tA*tB))}` }; } },
            { id: 'funcao-afim', category: 'Matemática', level: 'Ensino Médio', name: 'Função Afim (1º Grau)', formula_display: 'y = ax + b', description: "Modela relações de crescimento ou decaimento linear e constante. Usada para descrever custos, planos e movimento uniforme.", inputs: [ { id: 'a', label: 'Coeficiente Angular (a)' }, { id: 'x', label: 'Variável (x)' }, { id: 'b', label: 'Coeficiente Linear (b)' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const x=parseFloat(inputs.x.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); if([a,x,b].some(isNaN)) return {result:'Erro'}; return { result: `y = ${formatNumber(a*x+b)}` }; } },
            { id: 'vertice-parabola', category: 'Matemática', level: 'Ensino Médio', name: 'Vértice da Parábola', formula_display: 'X_v = \\frac{-b}{2a}, Y_v = \\frac{-\\Delta}{4a}', description: "Encontra o ponto de máximo ou mínimo de uma função do segundo grau. Crucial para problemas de otimização.", inputs: [ { id: 'a', label: 'Valor de a' }, { id: 'b', label: 'Valor de b' }, { id: 'c', label: 'Valor de c' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); const c=parseFloat(inputs.c.replace(',','.')); if(isNaN(a)||isNaN(b)||isNaN(c)||a===0) return {result:'Erro'}; const delta=b*b-4*a*c; return { result: `V = (${formatNumber(-b/(2*a))}, ${formatNumber(-delta/(4*a))})` }; } },
            { id: 'soma-pa', category: 'Matemática', level: 'Ensino Médio', name: 'Soma de uma PA Finita', formula_display: 'S_n = \\frac{(a_1 + a_n)n}{2}', description: "Calcula a soma dos termos de uma Progressão Aritmética. Útil para somar sequências com crescimento constante.", inputs: [ { id: 'a1', label: 'Primeiro termo (a₁)' }, { id: 'an', label: 'Último termo (aₙ)' }, { id: 'n', label: 'Número de termos (n)' } ], calculationFunction: (inputs) => { const a1=parseFloat(inputs.a1.replace(',','.')); const an=parseFloat(inputs.an.replace(',','.')); const n=parseInt(inputs.n); if([a1,an,n].some(isNaN)||n<=0) return {result:'Erro'}; return { result: `Sₙ = ${formatNumber(((a1+an)*n)/2)}` }; } },
            { id: 'soma-pg', category: 'Matemática', level: 'Ensino Médio', name: 'Soma de uma PG Finita', formula_display: 'S_n = \\frac{a_1(q^n - 1)}{q-1}', description: "Calcula a soma dos termos de uma Progressão Geométrica. Fundamental para calcular juros compostos.", inputs: [ { id: 'a1', label: 'Primeiro termo (a₁)' }, { id: 'q', label: 'Razão (q)' }, { id: 'n', label: 'Número de termos (n)' } ], calculationFunction: (inputs) => { const a1=parseFloat(inputs.a1.replace(',','.')); const q=parseFloat(inputs.q.replace(',','.')); const n=parseInt(inputs.n); if([a1,q,n].some(isNaN)||n<=0||q===1) return {result:'Erro'}; return { result: `Sₙ = ${formatNumber(a1*(Math.pow(q,n)-1)/(q-1))}` }; } },
            { id: 'funcao-exponencial', category: 'Matemática', level: 'Ensino Médio', name: 'Função Exponencial', formula_display: 'y = a^x', description: "Modela fenômenos de crescimento ou decaimento muito rápidos, como juros compostos ou decaimento radioativo.", inputs: [ { id: 'a', label: 'Base (a)' }, { id: 'x', label: 'Expoente (x)' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const x=parseFloat(inputs.x.replace(',','.')); if(isNaN(a)||isNaN(x)) return {result:'Erro'}; return { result: `y = ${formatNumber(Math.pow(a,x))}` }; } },
            { id: 'logaritmo', category: 'Matemática', level: 'Ensino Superior', name: 'Cálculo de Logaritmo', formula_display: 'log_b(x) = y \\iff b^y = x', description: "A operação inversa da exponenciação. Vital para medir grandezas como pH, decibéis e a escala Richter.", inputs: [ { id: 'x', label: 'Logaritmando (x)' }, { id: 'b', label: 'Base (b)' } ], calculationFunction: (inputs) => { const x=parseFloat(inputs.x.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); if(isNaN(x)||isNaN(b)||x<=0||b<=0||b===1) return {result:'Erro'}; return { result: `log_${b}(${x}) = ${formatNumber(Math.log(x)/Math.log(b))}` }; } },
            { id: 'derivada-potencia', category: 'Matemática', level: 'Ensino Superior', name: 'Derivada (Regra da Potência)', formula_display: '\\frac{d}{dx}(ax^n) = anx^{n-1}', description: "Regra do Cálculo Diferencial para encontrar a taxa de variação de funções polinomiais. Base para otimização.", inputs: [ { id: 'a', label: 'Coeficiente (a)' }, { id: 'n', label: 'Expoente (n)' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const n=parseFloat(inputs.n.replace(',','.')); if(isNaN(a)||isNaN(n)) return {result:'Erro'}; return { result: `d/dx = ${formatNumber(a*n)}x^${formatNumber(n-1)}` }; } },
            { id: 'soma-pg-infinita', category: 'Matemática', level: 'Ensino Superior', name: 'Soma de uma PG Infinita', formula_display: 'S = \\frac{a_1}{1-q}', description: "Calcula a soma de uma série geométrica infinita, se a razão for entre -1 e 1. Usada para modelar processos que convergem.", inputs: [ { id: 'a1', label: 'Primeiro termo (a₁)' }, { id: 'q', label: 'Razão (q)' } ], calculationFunction: (inputs) => { const a1=parseFloat(inputs.a1.replace(',','.')); const q=parseFloat(inputs.q.replace(',','.')); if(isNaN(a1)||isNaN(q)||Math.abs(q)>=1) return {result:'Erro: |q| deve ser < 1'}; return { result: `S = ${formatNumber(a1/(1-q))}` }; } },
            { id: 'lei-senos', category: 'Matemática', level: 'Ensino Médio', name: 'Lei dos Senos', formula_display: '\\frac{a}{\\sin(A)} = \\frac{b}{\\sin(B)} = \\frac{c}{\\sin(C)}', description: "Relaciona os lados de um triângulo aos senos de seus ângulos opostos. Usada para encontrar lados ou ângulos desconhecidos.", inputs: [ { id: 'a', label: 'Lado a', unit: '' }, { id: 'A', label: 'Ângulo A (oposto a a)', unit: 'graus' }, { id: 'B', label: 'Ângulo B', unit: 'graus' }, ], calculationFunction: (inputs) => { const a = parseFloat(inputs.a.replace(',', '.')); const A = parseFloat(inputs.A.replace(',', '.')); const B = parseFloat(inputs.B.replace(',', '.')); if ([a, A, B].some(isNaN) || a <= 0 || A <= 0 || B <= 0) return { result: 'Erro' }; const b = (a * Math.sin(B * Math.PI / 180)) / Math.sin(A * Math.PI / 180); return { result: `Lado b ≈ ${formatNumber(b)}` }; } },
            { id: 'lei-cossenos', category: 'Matemática', level: 'Ensino Médio', name: 'Lei dos Cossenos', formula_display: 'c^2 = a^2 + b^2 - 2ab \\cos(C)', description: "Generalização do Teorema de Pitágoras, usada para encontrar um lado de um triângulo quando se conhecem os outros dois lados.", inputs: [ { id: 'a', label: 'Lado a', unit: '' }, { id: 'b', label: 'Lado b', unit: '' }, { id: 'C', label: 'Ângulo C (entre a e b)', unit: 'graus' }, ], calculationFunction: (inputs) => { const a = parseFloat(inputs.a.replace(',', '.')); const b = parseFloat(inputs.b.replace(',', '.')); const C = parseFloat(inputs.C.replace(',', '.')); if ([a, b, C].some(isNaN) || a <= 0 || b <= 0 || C <= 0) return { result: 'Erro' }; const c2 = (a*a) + (b*b) - (2 * a * b * Math.cos(C * Math.PI / 180)); return { result: `Lado c ≈ ${formatNumber(Math.sqrt(c2))}` }; } },
            
             // --- FÍSICA ---
            { id: 'velocidade-media', category: 'Física', level: 'Ensino Fundamental', name: 'Velocidade Média', formula_display: 'V_m = \\frac{\\Delta S}{\\Delta t}', description: "Calcula a taxa média de deslocamento de um objeto. Essencial para entender o movimento e planejar viagens.", inputs: [ { id: 'deltaS', label: 'Distância (ΔS)', unit: 'metros' }, { id: 'deltaT', label: 'Tempo (Δt)', unit: 'segundos' } ], calculationFunction: (inputs) => { const dS=parseFloat(inputs.deltaS.replace(',','.')); const dT=parseFloat(inputs.deltaT.replace(',','.')); if(isNaN(dS)||isNaN(dT)||dT===0) return {result:'Erro'}; return { result: `${formatNumber(dS/dT,2)} m/s` }; } },
            { id: 'peso-objeto', category: 'Física', level: 'Ensino Fundamental', name: 'Peso de um Objeto', formula_display: 'P = m \\cdot g', description: "Define o Peso como a força da gravidade sobre a massa. Diferencia 'massa' (matéria) de 'peso' (força).", inputs: [ { id: 'm', label: 'Massa (m)', unit: 'kg' }, { id: 'g', label: 'Gravidade (g)', unit: 'm/s²' } ], calculationFunction: (inputs) => { const m=parseFloat(inputs.m.replace(',','.')); const g=parseFloat(inputs.g.replace(',','.')); if(isNaN(m)||isNaN(g)) return {result:'Erro'}; return { result: `P = ${formatNumber(m*g,2)} N` }; } },
            { id: 'torricelli', category: 'Física', level: 'Ensino Médio', name: 'Equação de Torricelli', formula_display: 'v^2 = v_0^2 + 2a\\Delta S', description: "Relaciona velocidade, aceleração e distância sem usar o tempo. Útil para resolver problemas de cinemática de forma mais direta.", inputs: [ { id: 'v0', label: 'Velocidade Inicial (v₀)', unit: 'm/s' }, { id: 'a', label: 'Aceleração (a)', unit: 'm/s²' }, { id: 'deltaS', label: 'Distância (ΔS)', unit: 'm' } ], calculationFunction: (inputs) => { const v0=parseFloat(inputs.v0.replace(',','.')); const a=parseFloat(inputs.a.replace(',','.')); const dS=parseFloat(inputs.deltaS.replace(',','.')); if(isNaN(v0)||isNaN(a)||isNaN(dS)) return {result:'Erro'}; const v2=v0*v0+2*a*dS; if(v2<0) return {result:'Não há velocidade real.'}; return { result: `v = ${formatNumber(Math.sqrt(v2),2)} m/s` }; } },
            { id: 'newton-segunda-lei', category: 'Física', level: 'Ensino Médio', name: 'Segunda Lei de Newton', formula_display: 'F_r = m \\cdot a', description: "Princípio Fundamental da Dinâmica: a força resultante é igual à massa vezes a aceleração. Essencial para entender o movimento dos corpos.", inputs: [ { id: 'm', label: 'Massa (m)', unit: 'kg' }, { id: 'a', label: 'Aceleração (a)', unit: 'm/s²' } ], calculationFunction: (inputs) => { const m=parseFloat(inputs.m.replace(',','.')); const a=parseFloat(inputs.a.replace(',','.')); if(isNaN(m)||isNaN(a)) return {result:'Erro'}; return { result: `Fᵣ = ${formatNumber(m*a,2)} N` }; } },
            { id: 'lei-ohm', category: 'Física', level: 'Ensino Médio', name: 'Lei de Ohm', formula_display: 'V = R \\cdot I', description: "Descreve a relação entre tensão (V), resistência (R) e corrente (I) em um circuito elétrico. A base da eletrônica.", inputs: [ { id: 'R', label: 'Resistência (R)', unit: 'Ω (Ohms)' }, { id: 'I', label: 'Corrente (I)', unit: 'A (Amperes)' }, ], calculationFunction: (inputs) => { const R = parseFloat(inputs.R.replace(',', '.')); const I = parseFloat(inputs.I.replace(',', '.')); if (isNaN(R) || isNaN(I)) return { result: 'Erro' }; const V = R * I; return { result: `Tensão (V) = ${formatNumber(V, 2)} V` }; } },
            { id: 'trabalho-forca', category: 'Física', level: 'Ensino Médio', name: 'Trabalho de uma Força', formula_display: 'W = F \\cdot d \\cdot \\cos(\\theta)', description: "Calcula a energia transferida por uma força ao deslocar um objeto. Fundamental para estudos de energia mecânica.", inputs: [ { id: 'F', label: 'Força (F)', unit: 'N (Newtons)' }, { id: 'd', label: 'Distância (d)', unit: 'metros' }, { id: 'theta', label: 'Ângulo (θ) entre F e d', unit: 'graus' }, ], calculationFunction: (inputs) => { const F = parseFloat(inputs.F.replace(',', '.')); const d = parseFloat(inputs.d.replace(',', '.')); const theta = parseFloat(inputs.theta.replace(',', '.')); if (isNaN(F) || isNaN(d) || isNaN(theta)) return { result: 'Erro' }; const W = F * d * Math.cos(theta * Math.PI / 180); return { result: `Trabalho (W) = ${formatNumber(W, 2)} J (Joules)` }; } },
            { id: 'energia-cinetica', category: 'Física', level: 'Ensino Superior', name: 'Energia Cinética Relativística', formula_display: 'E_k = (\\gamma - 1)mc^2', description: "Calcula a energia de movimento em velocidades próximas à da luz, onde os efeitos da Teoria da Relatividade se tornam significativos.", inputs: [ { id: 'm', label: 'Massa de repouso (m)', unit: 'kg' }, { id: 'v', label: 'Velocidade (v)', unit: 'm/s' } ], calculationFunction: (inputs) => { const m=parseFloat(inputs.m.replace(',','.')); const v=parseFloat(inputs.v.replace(',','.')); const c=299792458; if(isNaN(m)||isNaN(v)||v>=c||v<0) return {result:'Erro'}; const g=1/Math.sqrt(1-(v*v)/(c*c)); const Ek=(g-1)*m*c*c; return { result: `Eₖ = ${formatExponential(Ek)} J` }; } },
            { id: 'energia-massa', category: 'Física', level: 'Ensino Superior', name: 'Equivalência Massa-Energia', formula_display: 'E = mc^2', description: "A famosa equação de Einstein que revela a equivalência entre massa e energia, a base da energia nuclear e da física moderna.", inputs: [ { id: 'm', label: 'Massa (m)', unit: 'kg' } ], calculationFunction: (inputs) => { const m=parseFloat(inputs.m.replace(',','.')); const c=299792458; if(isNaN(m)||m<0) return {result:'Erro'}; return { result: `E = ${formatExponential(m*c*c)} J` }; } },
            { id: 'gravitacao-universal', category: 'Física', level: 'Ensino Superior', name: 'Lei da Gravitação Universal', formula_display: 'F = G \\frac{m_1 m_2}{d^2}', description: "Calcula a força de atração gravitacional entre dois objetos com massa. Rege o movimento de planetas, estrelas e galáxias.", inputs: [ { id: 'm1', label: 'Massa do objeto 1 (m₁)', unit: 'kg' }, { id: 'm2', label: 'Massa do objeto 2 (m₂)', unit: 'kg' }, { id: 'd', label: 'Distância entre os centros (d)', unit: 'metros' }, ], calculationFunction: (inputs) => { const m1 = parseFloat(inputs.m1.replace(',', '.')); const m2 = parseFloat(inputs.m2.replace(',', '.')); const d = parseFloat(inputs.d.replace(',', '.')); const G = 6.67430e-11; if (isNaN(m1) || isNaN(m2) || isNaN(d) || d === 0) return { result: 'Erro' }; const F = G * (m1 * m2) / (d * d); return { result: `Força (F) ≈ ${formatExponential(F)} N` }; } },
            
            // --- QUÍMICA ---
            { id: 'densidade', category: 'Química', level: 'Ensino Fundamental', name: 'Cálculo de Densidade', formula_display: 'd = \\frac{m}{V}', description: "Mede a concentração de massa em um volume. É uma propriedade fundamental da matéria, usada para identificar substâncias.", inputs: [ { id: 'm', label: 'Massa (m)', unit: 'gramas' }, { id: 'V', label: 'Volume (V)', unit: 'mL' } ], calculationFunction: (inputs) => { const m=parseFloat(inputs.m.replace(',','.')); const V=parseFloat(inputs.V.replace(',','.')); if(isNaN(m)||isNaN(V)||V===0) return {result:'Erro'}; return { result: `d = ${formatNumber(m/V)} g/mL` }; } },
            { id: 'molaridade', category: 'Química', level: 'Ensino Médio', name: 'Cálculo de Molaridade', formula_display: 'M = \\frac{n}{V_{(L)}}', description: "Mede a concentração de uma solução em mols por litro. É a unidade de concentração mais comum em laboratórios.", inputs: [ { id: 'n', label: 'Nº de Mols (n)', unit: 'mol' }, { id: 'V', label: 'Volume da Solução (V)', unit: 'mL' } ], calculationFunction: (inputs) => { const n=parseFloat(inputs.n.replace(',','.')); const Vl=parseFloat(inputs.V.replace(',','.'))/1000; if(isNaN(n)||isNaN(Vl)||n<0||Vl<=0) return {result:'Erro'}; return { result: `M = ${formatNumber(n/Vl)} M` }; } },
            { id: 'diluicao', category: 'Química', level: 'Ensino Médio', name: 'Diluição de Soluções', formula_display: 'C_1 V_1 = C_2 V_2', description: "Calcula a concentração ou volume de uma solução após a diluição. Essencial para preparar soluções em laboratório.", inputs: [ { id: 'C1', label: 'Concentração Inicial (C₁)', unit: 'mol/L' }, { id: 'V1', label: 'Volume Inicial (V₁)', unit: 'mL' }, { id: 'V2', label: 'Volume Final (V₂)', unit: 'mL' }, ], calculationFunction: (inputs) => { const C1 = parseFloat(inputs.C1.replace(',', '.')); const V1 = parseFloat(inputs.V1.replace(',', '.')); const V2 = parseFloat(inputs.V2.replace(',', '.')); if ([C1, V1, V2].some(isNaN) || V2 === 0) return { result: 'Erro' }; const C2 = (C1 * V1) / V2; return { result: `Concentração Final (C₂) = ${formatNumber(C2, 4)} mol/L` }; } },
            { id: 'calculo-ph', category: 'Química', level: 'Ensino Médio', name: 'Cálculo de pH', formula_display: 'pH = -\\log[H^+]', description: "Calcula o potencial de acidez (pH) de uma solução a partir da concentração de íons H+. Mede se uma solução é ácida, neutra ou básica.", inputs: [ { id: 'H_plus', label: 'Concentração de [H⁺]', unit: 'mol/L' }, ], calculationFunction: (inputs) => { const H_plus = parseFloat(inputs.H_plus.replace(',', '.')); if (isNaN(H_plus) || H_plus <= 0) return { result: 'Erro' }; const pH = -Math.log10(H_plus); return { result: `pH ≈ ${formatNumber(pH, 2)}` }; } },
            { id: 'gases-ideais', category: 'Química', level: 'Ensino Médio', name: 'Equação dos Gases Ideais', formula_display: 'PV = nRT', description: "Relaciona pressão, volume e temperatura de um gás. É um modelo fundamental para prever o comportamento de gases em diversas condições.", inputs: [ { id: 'P', label: 'Pressão (P)', unit: 'atm' }, { id: 'V', label: 'Volume (V)', unit: 'L' }, { id: 'n', label: 'Nº de Mols (n)', unit: 'mol' } ], calculationFunction: (inputs) => { const P=parseFloat(inputs.P.replace(',','.')); const V=parseFloat(inputs.V.replace(',','.')); const n=parseFloat(inputs.n.replace(',','.')); const R=0.082; if(isNaN(P)||isNaN(V)||isNaN(n)||P<=0||V<=0||n<=0) return {result:'Erro'}; return { result: `T = ${formatNumber((P*V)/(n*R),2)} K` }; } },
            { id: 'lei-beer', category: 'Química', level: 'Ensino Superior', name: 'Lei de Beer-Lambert', formula_display: 'A = \\epsilon c l', description: "Relaciona a absorção de luz com as propriedades de um material. É a base da espectrofotometria para determinar a concentração de substâncias.", inputs: [ { id: 'epsilon', label: 'Absortividade Molar (ε)', unit: 'L mol⁻¹ cm⁻¹' }, { id: 'c', label: 'Concentração (c)', unit: 'mol/L' }, { id: 'l', label: 'Caminho Óptico (l)', unit: 'cm' } ], calculationFunction: (inputs) => { const e=parseFloat(inputs.epsilon.replace(',','.')); const c=parseFloat(inputs.c.replace(',','.')); const l=parseFloat(inputs.l.replace(',','.')); if(isNaN(e)||isNaN(c)||isNaN(l)||e<0||c<0||l<0) return {result:'Erro'}; return { result: `Absorvância (A) = ${formatNumber(e*c*l)}` }; } },
            { id: 'molar-mass', category: 'Química', level: 'Ensino Médio', name: 'Calculadora de Massa Molar', formula_display: 'M = \\sum_i (n_i \\cdot m_i)', description: "Calcula a massa molar de um composto (ex: H2O, C6H12O6). Essencial para cálculos estequiométricos.", inputs: [ { id: 'formula', label: 'Fórmula Química', type: 'text' } ], calculationFunction: (inputs) => { const f=inputs.formula.trim(); if(!f)return{result:'Insira uma fórmula.'}; try{let m=0;const atoms=f.match(/[A-Z][a-z]*\d*/g);if(!atoms)throw new Error('Fórmula inválida.');atoms.forEach(atom=>{const elSymbol=atom.match(/[A-Z][a-z]*/)[0];const count=parseInt(atom.match(/\d+/)||[1]);const elData=elements.find(e=>e.symbol===elSymbol);if(!elData)throw new Error(`Elemento ${elSymbol} não encontrado.`);m+=elData.atomic_mass*count;});return{result:`Massa molar ≈ ${formatNumber(m,4)} g/mol`};}catch(e){return{result:`Erro: ${e.message}`};} } },
            { id: 'gibbs-energia', category: 'Química', level: 'Ensino Superior', name: 'Energia Livre de Gibbs', formula_display: '\\Delta G = \\Delta H - T \\Delta S', description: "Determina se uma reação química ocorrerá espontaneamente, combinando entalpia (ΔH) e entropia (ΔS).", inputs: [ { id: 'deltaH', label: 'Variação de Entalpia (ΔH)', unit: 'kJ/mol' }, { id: 'T', label: 'Temperatura (T)', unit: 'Kelvin' }, { id: 'deltaS', label: 'Variação de Entropia (ΔS)', unit: 'J/mol·K' }, ], calculationFunction: (inputs) => { const dH = parseFloat(inputs.deltaH.replace(',', '.')); const T = parseFloat(inputs.T.replace(',', '.')); const dS_J = parseFloat(inputs.deltaS.replace(',', '.')); if ([dH, T, dS_J].some(isNaN)) return { result: 'Erro' }; const dS_kJ = dS_J / 1000; const dG = dH - (T * dS_kJ); let spontaneity = ''; if (dG < 0) spontaneity = '(Reação Espontânea)'; else if (dG > 0) spontaneity = '(Reação Não Espontânea)'; else spontaneity = '(Em Equilíbrio)'; return { result: `ΔG = ${formatNumber(dG, 3)} kJ/mol ${spontaneity}` }; } },
            { id: 'tabela-periodica', category: 'Química', level: 'Ensino Médio', name: 'Tabela Periódica Interativa', formula_display: 'Explore a \\: Tabela \\: Periódica', description: "Clique em um elemento para ver suas propriedades. Ferramenta de referência rápida para estudantes de química.", inputs: [], calculationFunction: () => ({ result: 'Clique nos elementos para ver os detalhes!' }) },

            // --- BIOLOGIA ---
            { id: 'hardy-weinberg', category: 'Biologia', level: 'Ensino Médio', name: 'Equilíbrio de Hardy-Weinberg', formula_display: 'p^2 + 2pq + q^2 = 1', description: "Descreve a frequência de alelos e genótipos em uma população que não está evoluindo. Base para a genética de populações.", inputs: [ { id: 'p', label: 'Frequência do alelo dominante (p)' } ], calculationFunction: (inputs) => { const p=parseFloat(inputs.p.replace(',','.')); if(isNaN(p)||p<0||p>1) return {result:'Erro'}; const q=1-p; return { result: `Frequências: AA=${formatNumber(p*p)}, Aa=${formatNumber(2*p*q)}, aa=${formatNumber(q*q)}` }; } },
            { id: 'densidade-populacional', category: 'Biologia', level: 'Ensino Médio', name: 'Densidade Populacional', formula_display: 'D = \\frac{N}{A}', description: "Calcula o número de indivíduos de uma população por unidade de área, uma medida chave em estudos de ecologia.", inputs: [ { id: 'N', label: 'Número de Indivíduos (N)' }, { id: 'A', label: 'Área ou Volume (A)', unit: 'm² ou m³' }, ], calculationFunction: (inputs) => { const N = parseFloat(inputs.N.replace(',', '.')); const A = parseFloat(inputs.A.replace(',', '.')); if(isNaN(N) || isNaN(A) || N < 0 || A <= 0) return { result: 'Erro' }; const D = N / A; return { result: `D ≈ ${formatNumber(D)} indivíduos/unidade` }; } },
            { id: 'crescimento-logistico', category: 'Biologia', level: 'Ensino Superior', name: 'Crescimento Populacional Logístico', formula_display: '\\frac{dN}{dt} = rN(1 - \\frac{N}{K})', description: "Modela o crescimento de uma população considerando a limitação de recursos do ambiente (capacidade de suporte K).", inputs: [ { id: 'r', label: 'Taxa de crescimento (r)' }, { id: 'N', label: 'População atual (N)' }, { id: 'K', label: 'Capacidade de suporte (K)' } ], calculationFunction: (inputs) => { const r=parseFloat(inputs.r.replace(',','.')); const N=parseFloat(inputs.N.replace(',','.')); const K=parseFloat(inputs.K.replace(',','.')); if(isNaN(r)||isNaN(N)||isNaN(K)||N<0||K<=0) return {result:'Erro'}; return { result: `Taxa de crescimento ≈ ${formatNumber(r*N*(1-N/K))}` }; } },
            { id: 'estimativa-populacao', category: 'Biologia', level: 'Ensino Superior', name: 'Estimativa de População (Captura-Recaptura)', formula_display: 'N = \\frac{M \\cdot C}{R}', description: "Método para estimar o tamanho de uma população animal com base em indivíduos marcados e recapturados.", inputs: [ { id: 'M', label: 'Indivíduos Marcados e Soltos (M)' }, { id: 'C', label: 'Total Capturado na 2ª Amostra (C)' }, { id: 'R', label: 'Marcados Recapturados (R)' }, ], calculationFunction: (inputs) => { const M = parseInt(inputs.M); const C = parseInt(inputs.C); const R = parseInt(inputs.R); if ([M, C, R].some(isNaN) || R === 0 || M < 0 || C < 0 || R < 0) return { result: 'Erro' }; const N = (M * C) / R; return { result: `População Estimada (N) ≈ ${formatNumber(Math.round(N))} indivíduos` }; } },
            
            // --- SAÚDE (NOVA CATEGORIA) ---
            { id: 'fcmax', category: 'Saúde', level: 'Ensino Fundamental', name: 'Frequência Cardíaca Máxima', formula_display: 'FC_{max} \\approx 220 - \\text{idade}', description: "Estima a frequência cardíaca máxima com base na idade, um referencial importante para atividades físicas.", inputs: [ { id: 'idade', label: 'Sua Idade', unit: 'anos' } ], calculationFunction: (inputs) => { const idade=parseFloat(inputs.idade.replace(',','.')); if(isNaN(idade)||idade<=0||idade>120) return {result:'Erro'}; return { result: `FCₘₐₓ ≈ ${220-idade} bpm` }; } },
            { id: 'imc', category: 'Saúde', level: 'Ensino Médio', name: 'Índice de Massa Corporal (IMC)', formula_display: 'IMC = \\frac{\\text{Peso}}{\\text{Altura}^2}', description: "Avalia se o peso de uma pessoa está na faixa saudável para sua altura. Usado como indicador de saúde geral.", inputs: [ { id: 'peso', label: 'Peso', unit: 'kg' }, { id: 'altura', label: 'Altura', unit: 'cm' } ], calculationFunction: (inputs) => { const p=parseFloat(inputs.peso.replace(',','.')); const a=parseFloat(inputs.altura.replace(',','.'))/100; if(isNaN(p)||isNaN(a)||p<=0||a<=0) return {result:'Erro'}; const imc=p/(a*a); let c=''; if(imc<18.5)c='Abaixo do peso'; else if(imc<25)c='Peso normal'; else if(imc<30)c='Sobrepeso'; else if(imc<35)c='Obesidade Grau I'; else if(imc<40)c='Obesidade Grau II'; else c='Obesidade Grau III'; return { result: `IMC = ${formatNumber(imc,1)} (${c})` }; } },
            { id: 'taxa-metabolica-basal', category: 'Saúde', level: 'Ensino Médio', name: 'Taxa Metabólica Basal (TMB)', formula_display: 'TMB = f(\\text{peso, altura, idade})', description: "Estima o número de calorias que o seu corpo queima em repouso. Essencial para planos de dieta e controlo de peso.", inputs: [ { id: 'sexo', label: 'Sexo', type: 'select', options: [{value: 'homem', text: 'Homem'}, {value:'mulher', text:'Mulher'}] }, { id: 'peso', label: 'Peso', unit: 'kg' }, { id: 'altura', label: 'Altura', unit: 'cm' }, { id: 'idade', label: 'Idade', unit: 'anos' }], calculationFunction: (inputs) => { const p = parseFloat(inputs.peso.replace(',','.')); const a = parseFloat(inputs.altura.replace(',','.')); const i = parseFloat(inputs.idade.replace(',','.')); if(isNaN(p)||isNaN(a)||isNaN(i)||p<=0||a<=0||i<=0) return {result:'Erro'}; let tmb; if(inputs.sexo === 'homem') { tmb = 88.362 + (13.397 * p) + (4.799 * a) - (5.677 * i); } else { tmb = 447.593 + (9.247 * p) + (3.098 * a) - (4.330 * i); } return { result: `TMB ≈ ${formatNumber(tmb, 0)} kcal/dia` }; } },

            // --- FINANÇAS (NOVA CATEGORIA) ---
            { id: 'juros-simples', category: 'Finanças', level: 'Ensino Fundamental', name: 'Juros Simples', formula_display: 'J = C \\cdot i \\cdot t', description: "Calcula o rendimento de um capital a uma taxa fixa. É a base para entender transações financeiras simples.", inputs: [ { id: 'C', label: 'Capital (C)', unit: 'R$' }, { id: 'i', label: 'Taxa (i)', unit: '% ao período' }, { id: 't', label: 'Tempo (t)', unit: 'períodos' } ], calculationFunction: (inputs) => { const C=parseFloat(inputs.C.replace(',','.')); const i=parseFloat(inputs.i.replace(',','.'))/100; const t=parseFloat(inputs.t.replace(',','.')); if(isNaN(C)||isNaN(i)||isNaN(t)) return {result:'Erro'}; const J=C*i*t; return { result: `Juros = R$ ${formatMoney(J)} | Montante = R$ ${formatMoney(C+J)}` }; } },
            { id: 'juros-compostos', category: 'Finanças', level: 'Ensino Médio', name: 'Juros Compostos', formula_display: 'M = C(1+i)^t', description: "Calcula o montante de um investimento com juros sobre juros, mostrando o poder do crescimento exponencial.", inputs: [ { id: 'C', label: 'Capital Inicial (C)', unit: 'R$' }, { id: 'i', label: 'Taxa (i)', unit: '% ao período' }, { id: 't', label: 'Tempo (t)', unit: 'períodos' }], calculationFunction: (inputs) => { const C = parseFloat(inputs.C.replace(',','.')); const i = parseFloat(inputs.i.replace(',','.')) / 100; const t = parseFloat(inputs.t.replace(',','.')); if(isNaN(C)||isNaN(i)||isNaN(t)) return {result:'Erro'}; const M = C * Math.pow((1 + i), t); return { result: `Montante = R$ ${formatMoney(M)} | Juros = R$ ${formatMoney(M - C)}` }; } },
            { id: 'calculadora-gorjeta', category: 'Finanças', level: 'Dia a Dia', name: 'Calculadora de Gorjeta', formula_display: '\\text{Total} = \\text{Conta} \\times (1 + \\frac{\\%}{100})', description: "Calcule facilmente a gorjeta e o valor total da conta. Útil para dividir despesas em restaurantes.", inputs: [ { id: 'conta', label: 'Valor da Conta', unit: 'R$' }, { id: 'gorjeta', label: 'Gorjeta', unit: '%' }], calculationFunction: (inputs) => { const conta = parseFloat(inputs.conta.replace(',','.')); const gorjeta = parseFloat(inputs.gorjeta.replace(',','.')) / 100; if(isNaN(conta)||isNaN(gorjeta)) return {result:'Erro'}; const valorGorjeta = conta * gorjeta; const total = conta + valorGorjeta; return { result: `Gorjeta = R$ ${formatMoney(valorGorjeta)} | Total = R$ ${formatMoney(total)}` }; } },
            { id: 'desconto-percentual', category: 'Finanças', level: 'Dia a Dia', name: 'Calculadora de Descontos', formula_display: 'P_{final} = P_{orig} \\times (1 - \\frac{\\%}{100})', description: "Descubra o preço final de um produto após um desconto percentual. Perfeito para épocas de saldos!", inputs: [ { id: 'preco', label: 'Preço Original', unit: 'R$' }, { id: 'desconto', label: 'Desconto', unit: '%' }], calculationFunction: (inputs) => { const preco = parseFloat(inputs.preco.replace(',','.')); const desconto = parseFloat(inputs.desconto.replace(',','.')) / 100; if(isNaN(preco)||isNaN(desconto)) return {result:'Erro'}; const valorDesconto = preco * desconto; const final = preco - valorDesconto; return { result: `Desconto = R$ ${formatMoney(valorDesconto)} | Preço Final = R$ ${formatMoney(final)}` }; } },

            // --- GEOMETRIA ---
            { id: 'area-quadrado', category: 'Geometria', level: 'Ensino Fundamental', name: 'Área do Quadrado', formula_display: 'A = l^2', description: "Calcula a medida da superfície de um quadrado. Fórmula básica da geometria para medição de terrenos e espaços com lados iguais.", inputs: [ { id: 'l', label: 'Lado (l)', unit: 'cm' } ], calculationFunction: (inputs) => { const l=parseFloat(inputs.l.replace(',','.')); if(isNaN(l)||l<=0) return {result:'Erro'}; return { result: `A = ${formatNumber(l*l)} cm²` }; } },
            { id: 'area-retangulo', category: 'Geometria', level: 'Ensino Fundamental', name: 'Área do Retângulo', formula_display: 'A = b \\cdot h', description: "Calcula a medida da superfície de um retângulo. É uma fórmula fundamental para medir qualquer espaço retangular.", inputs: [ { id: 'b', label: 'Base (b)', unit: 'cm' }, { id: 'h', label: 'Altura (h)', unit: 'cm' } ], calculationFunction: (inputs) => { const b=parseFloat(inputs.b.replace(',','.')); const h=parseFloat(inputs.h.replace(',','.')); if(isNaN(b)||isNaN(h)||b<=0||h<=0) return {result:'Erro'}; return { result: `A = ${formatNumber(b*h)} cm²` }; } },
            { id: 'area-triangulo', category: 'Geometria', level: 'Ensino Fundamental', name: 'Área do Triângulo', formula_display: 'A = \\frac{b \\cdot h}{2}', description: "Calcula a medida da superfície de um triângulo. É a base para calcular a área de polígonos mais complexos.", inputs: [ { id: 'b', label: 'Base (b)', unit: 'cm' }, { id: 'h', label: 'Altura (h)', unit: 'cm' } ], calculationFunction: (inputs) => { const b=parseFloat(inputs.b.replace(',','.')); const h=parseFloat(inputs.h.replace(',','.')); if(isNaN(b)||isNaN(h)||b<=0||h<=0) return {result:'Erro'}; return { result: `A = ${formatNumber((b*h)/2)} cm²` }; } },
            { id: 'area-circulo', category: 'Geometria', level: 'Ensino Fundamental', name: 'Área do Círculo', formula_display: 'A = \\pi \\cdot r^2', description: "Calcula a área de um círculo a partir do seu raio. Essencial em engenharia, design e ciência.", inputs: [ { id: 'r', label: 'Raio (r)', unit: 'cm' } ], calculationFunction: (inputs) => { const r=parseFloat(inputs.r.replace(',','.')); if(isNaN(r)||r<=0) return {result:'Erro'}; return { result: `A = ${formatNumber(Math.PI*r*r)} cm²` }; } },
            { id: 'area-paralelogramo', category: 'Geometria', level: 'Ensino Fundamental', name: 'Área do Paralelogramo', formula_display: 'A = b \\cdot h', description: "Calcula a área de um paralelogramo. Útil para medir terrenos ou objetos com lados paralelos.", inputs: [ { id: 'b', label: 'Base (b)', unit: 'cm' }, { id: 'h', label: 'Altura (h)', unit: 'cm' } ], calculationFunction: (inputs) => { const b=parseFloat(inputs.b.replace(',','.')); const h=parseFloat(inputs.h.replace(',','.')); if(isNaN(b)||isNaN(h)||b<=0||h<=0) return {result:'Erro'}; return { result: `A = ${formatNumber(b*h)} cm²` }; } },
            { id: 'area-losango', category: 'Geometria', level: 'Ensino Fundamental', name: 'Área do Losango', formula_display: 'A = \\frac{D \\cdot d}{2}', description: "Calcula a área de um losango a partir de suas diagonais. É útil em design e cristalografia.", inputs: [ { id: 'D', label: 'Diagonal Maior (D)', unit: 'cm' }, { id: 'd', label: 'Diagonal Menor (d)', unit: 'cm' } ], calculationFunction: (inputs) => { const D=parseFloat(inputs.D.replace(',','.')); const d=parseFloat(inputs.d.replace(',','.')); if(isNaN(D)||isNaN(d)||D<=0||d<=0) return {result:'Erro'}; return { result: `A = ${formatNumber((D*d)/2)} cm²` }; } },
            { id: 'area-trapezio', category: 'Geometria', level: 'Ensino Fundamental', name: 'Área do Trapézio', formula_display: 'A = \\frac{(B+b)h}{2}', description: "Calcula a área de um trapézio. Comum em arquitetura e engenharia para medir áreas com apenas dois lados paralelos.", inputs: [ { id: 'B', label: 'Base Maior (B)', unit: 'cm' }, { id: 'b', label: 'Base Menor (b)', unit: 'cm' }, { id: 'h', label: 'Altura (h)', unit: 'cm' } ], calculationFunction: (inputs) => { const B=parseFloat(inputs.B.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); const h=parseFloat(inputs.h.replace(',','.')); if([B,b,h].some(isNaN)||B<=0||b<=0||h<=0) return {result:'Erro'}; return { result: `A = ${formatNumber(((B+b)*h)/2)} cm²` }; } },
            { id: 'perimetro-quadrado', category: 'Geometria', level: 'Ensino Fundamental', name: 'Perímetro do Quadrado', formula_display: 'P = 4 \\cdot l', description: "Calcula o comprimento total do contorno de um quadrado. Útil para medir cercas e molduras.", inputs: [ { id: 'l', label: 'Lado (l)', unit: 'cm' } ], calculationFunction: (inputs) => { const l=parseFloat(inputs.l.replace(',','.')); if(isNaN(l)||l<=0) return {result:'Erro'}; return { result: `P = ${formatNumber(4*l,2)} cm` }; } },
            { id: 'comprimento-circunferencia', category: 'Geometria', level: 'Ensino Fundamental', name: 'Comprimento da Circunferência', formula_display: 'C = 2 \\pi r', description: "Calcula o comprimento do contorno de um círculo. Crucial para o design de rodas e engrenagens.", inputs: [ { id: 'r', label: 'Raio (r)', unit: 'cm' } ], calculationFunction: (inputs) => { const r=parseFloat(inputs.r.replace(',','.')); if(isNaN(r)||r<=0) return {result:'Erro'}; return { result: `C = ${formatNumber(2*Math.PI*r)} cm` }; } },
            { id: 'pitagoras', category: 'Geometria', level: 'Ensino Médio', name: 'Teorema de Pitágoras', formula_display: 'a^2 = b^2 + c^2', description: "Encontra a hipotenusa de um triângulo retângulo a partir dos catetos. Base da geometria e trigonometria.", inputs: [ { id: 'b', label: 'Cateto b', unit: 'cm' }, { id: 'c', label: 'Cateto c', unit: 'cm' } ], calculationFunction: (inputs) => { const b=parseFloat(inputs.b.replace(',','.')); const c=parseFloat(inputs.c.replace(',','.')); if(isNaN(b)||isNaN(c)||b<=0||c<=0) return {result:'Erro'}; return { result: `Hipotenusa (a) = ${formatNumber(Math.sqrt(b*b+c*c))} cm` }; } },
            { id: 'teorema-tales', category: 'Geometria', level: 'Ensino Médio', name: 'Teorema de Tales', formula_display: '\\frac{a}{b} = \\frac{c}{x}', description: "Resolve problemas de proporcionalidade entre segmentos de retas cortadas por retas paralelas. Usado para medir alturas inacessíveis.", inputs: [ { id: 'a', label: 'Segmento a' }, { id: 'b', label: 'Segmento b' }, { id: 'c', label: 'Segmento c' } ], calculationFunction: (inputs) => { const a=parseFloat(inputs.a.replace(',','.')); const b=parseFloat(inputs.b.replace(',','.')); const c=parseFloat(inputs.c.replace(',','.')); if([a,b,c].some(isNaN)||a===0) return {result:'Erro'}; return { result: `x = ${formatNumber((b*c)/a)}` }; } },
            { id: 'volume-esfera', category: 'Geometria', level: 'Ensino Médio', name: 'Volume da Esfera', formula_display: 'V = \\frac{4}{3}\\pi r^3', description: "Calcula o espaço ocupado por uma esfera. Essencial em astrofísica para calcular o volume de planetas.", inputs: [ { id: 'r', label: 'Raio (r)', unit: 'cm' } ], calculationFunction: (inputs) => { const r=parseFloat(inputs.r.replace(',','.')); if(isNaN(r)||r<=0) return {result:'Erro'}; return { result: `V = ${formatNumber((4/3)*Math.PI*Math.pow(r,3))} cm³` }; } },
            { id: 'volume-cilindro', category: 'Geometria', level: 'Ensino Médio', name: 'Volume do Cilindro', formula_display: 'V = \\pi r^2 h', description: "Calcula o espaço ocupado por um cilindro. Usado na indústria para calcular a capacidade de tanques e latas.", inputs: [ { id: 'r', label: 'Raio da base (r)', unit: 'cm' }, { id: 'h', label: 'Altura (h)', unit: 'cm' } ], calculationFunction: (inputs) => { const r=parseFloat(inputs.r.replace(',','.')); const h=parseFloat(inputs.h.replace(',','.')); if(isNaN(r)||isNaN(h)||r<=0||h<=0) return {result:'Erro'}; return { result: `V = ${formatNumber(Math.PI*r*r*h)} cm³` }; } },
            { id: 'area-triangulo-equilatero', category: 'Geometria', level: 'Ensino Médio', name: 'Área do Triângulo Equilátero', formula_display: 'A = \\frac{l^2\\sqrt{3}}{4}', description: "Calcula a área de um triângulo com todos os três lados iguais. Simplifica o cálculo para esta forma geométrica comum.", inputs: [ { id: 'l', label: 'Lado (l)', unit: 'cm' } ], calculationFunction: (inputs) => { const l=parseFloat(inputs.l.replace(',','.')); if(isNaN(l)||l<=0) return {result:'Erro'}; return { result: `A = ${formatNumber((l*l*Math.sqrt(3))/4)} cm²` }; } },
            { id: 'soma-angulos-poligono', category: 'Geometria', level: 'Ensino Médio', name: 'Soma dos Ângulos Internos de um Polígono', formula_display: 'S = (n-2) \\cdot 180°', description: "Fornece a soma de todos os ângulos internos de um polígono com 'n' lados. Ajuda no design e construção de estruturas.", inputs: [ { id: 'n', label: 'Nº de lados (n)' } ], calculationFunction: (inputs) => { const n=parseInt(inputs.n); if(isNaN(n)||n<3) return {result:'Erro (n≥3)'}; return { result: `S = ${formatNumber((n-2)*180)}°` }; } },
            { id: 'area-hexagono-regular', category: 'Geometria', level: 'Ensino Médio', name: 'Área do Hexágono Regular', formula_display: 'A = \\frac{3l^2\\sqrt{3}}{2}', description: "Calcula a área de um polígono de seis lados iguais. O hexágono é uma forma muito eficiente encontrada na natureza.", inputs: [ { id: 'l', label: 'Lado (l)', unit: 'cm' } ], calculationFunction: (inputs) => { const l=parseFloat(inputs.l.replace(',','.')); if(isNaN(l)||l<=0) return {result:'Erro'}; return { result: `A = ${formatNumber((3*l*l*Math.sqrt(3))/2)} cm²` }; } },
            { id: 'triangulo-inscrito', category: 'Geometria', level: 'Ensino Médio', name: 'Triângulo Equilátero Inscrito', formula_display: 'l = R\\sqrt{3}', description: "Relaciona o lado de um triângulo equilátero com o raio da circunferência que o circunscreve. Usada em geometria construtiva.", inputs: [ { id: 'R', label: 'Raio da Circunferência (R)', unit: 'cm' } ], calculationFunction: (inputs) => { const R=parseFloat(inputs.R.replace(',','.')); if(isNaN(R)||R<=0) return {result:'Erro'}; return { result: `Lado (l) = ${formatNumber(R*Math.sqrt(3))} cm` }; } },
            { id: 'quadrado-inscrito', category: 'Geometria', level: 'Ensino Médio', name: 'Quadrado Inscrito', formula_display: 'l = R\\sqrt{2}', description: "Relaciona o lado de um quadrado com o raio da circunferência que o circunscreve. Usada em problemas de otimização de espaço.", inputs: [ { id: 'R', label: 'Raio da Circunferência (R)', unit: 'cm' } ], calculationFunction: (inputs) => { const R=parseFloat(inputs.R.replace(',','.')); if(isNaN(R)||R<=0) return {result:'Erro'}; return { result: `Lado (l) = ${formatNumber(R*Math.sqrt(2))} cm` }; } },
            { id: 'hexagono-inscrito', category: 'Geometria', level: 'Ensino Médio', name: 'Hexágono Regular Inscrito', formula_display: 'l = R', description: "Relaciona o lado de um hexágono regular com o raio da circunferência que o circunscreve (são iguais!).", inputs: [ { id: 'R', label: 'Raio da Circunferência (R)', unit: 'cm' } ], calculationFunction: (inputs) => { const R=parseFloat(inputs.R.replace(',','.')); if(isNaN(R)||R<=0) return {result:'Erro'}; return { result: `Lado (l) = ${formatNumber(R)} cm` }; } },
            { id: 'distancia-pontos', category: 'Geometria', level: 'Ensino Superior', name: 'Distância Entre Dois Pontos', formula_display: 'd = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}', description: "Calcula a distância em linha reta entre dois pontos em um plano cartesiano. Fundamental para a geometria analítica e GPS.", inputs: [ { id: 'x1', label: 'Ponto A (x₁)' }, { id: 'y1', label: 'Ponto A (y₁)' }, { id: 'x2', label: 'Ponto B (x₂)' }, { id: 'y2', label: 'Ponto B (y₂)' } ], calculationFunction: (inputs) => { const x1=parseFloat(inputs.x1.replace(',','.')); const y1=parseFloat(inputs.y1.replace(',','.')); const x2=parseFloat(inputs.x2.replace(',','.')); const y2=parseFloat(inputs.y2.replace(',','.')); if([x1,y1,x2,y2].some(isNaN)) return {result:'Erro'}; return { result: `d = ${formatNumber(Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)))}` }; } },

             // --- PORTUGUÊS ---
            { id: 'corretor-ortografico', category: 'Português', level: 'Ensino Fundamental', name: 'Corretor Ortográfico e Gramatical', formula_display: 'Corrija meu texto', description: "Escreva um texto e a IA irá revisar a gramática, ortografia e pontuação, sugerindo melhorias para você.", inputs: [ { id: 'text', label: 'Texto para corrigir', type: 'textarea' } ], calculationFunction: async (inputs) => { const prompt = `Corrija o seguinte texto, explicando brevemente cada erro em uma lista: "${inputs.text}"`; return await callAI(prompt, 'Você é um revisor de texto profissional.'); } },
            { id: 'resumidor-texto', category: 'Português', level: 'Ensino Médio', name: 'Resumidor de Texto', formula_display: 'Resuma este texto', description: "Cole um texto longo e a IA criará um resumo conciso, destacando os pontos principais para facilitar seu estudo.", inputs: [ { id: 'text', label: 'Texto para resumir', type: 'textarea' } ], calculationFunction: async (inputs) => { const prompt = `Resuma o seguinte texto em um parágrafo conciso: "${inputs.text}"`; return await callAI(prompt, 'Você é um especialista em sintetizar informações.'); } },
            { id: 'explicador-porques', category: 'Português', level: 'Ensino Médio', name: 'Tira-dúvidas dos Porquês', formula_display: 'Por que...?', description: "Dúvida sobre por que, por quê, porque ou porquê? Escreva a frase e a IA explicará qual usar com exemplos.", inputs: [ { id: 'text', label: 'Sua dúvida ou frase', type: 'textarea' } ], calculationFunction: async (inputs) => { const prompt = `Explique o uso correto dos 'porquês' na seguinte frase ou dúvida, dando uma regra clara e exemplos: "${inputs.text}"`; return await callAI(prompt, 'Você é um professor de português didático.'); } },
            { id: 'gerador-redacao', category: 'Português', level: 'Ensino Médio', name: 'Gerador de Estrutura de Redação', formula_display: 'Tema da Redação', description: "Digite um tema e a IA irá gerar uma estrutura de redação (introdução, desenvolvimento e conclusão) para você começar.", inputs: [ { id: 'text', label: 'Tema da Redação', type: 'textarea' } ], calculationFunction: async (inputs) => { const prompt = `Crie um esqueleto de redação com 3 parágrafos (introdução, desenvolvimento, conclusão) para o tema: "${inputs.text}". Dê ideias para cada parte.`; return await callAI(prompt, 'Você é um assistente de redação.'); } },
            { id: 'analise-sintatica', category: 'Português', level: 'Ensino Superior', name: 'Análise Sintática', formula_display: 'Sujeito + Verbo + Predicado', description: "Digite uma oração e a IA identificará o sujeito, predicado, objetos e outros termos sintáticos para você.", inputs: [ { id: 'text', label: 'Oração para analisar', type: 'textarea' } ], calculationFunction: async (inputs) => { const prompt = `Faça a análise sintática completa da seguinte oração, identificando sujeito, predicado, tipo de verbo, objetos, etc.: "${inputs.text}"`; return await callAI(prompt, 'Você é um especialista em gramática e análise sintática.'); } },

            // --- IA HELPER ---
            {
                id: 'ia-helper', category: 'IA', level: 'Inteligência Artificial', name: 'IA Resolve',
                formula_display: 'Pergunte para a IA',
                description: "Não encontrou o que precisava? Descreva seu problema ou pergunta e nossa IA geral irá resolvê-lo e explicar o passo a passo.",
                inputs: [ { id: 'query', label: 'Qual é a sua dúvida?', type: 'textarea' } ],
                calculationFunction: async (inputs) => {
                    const query = inputs.query;
                    if (!query.trim()) return { result: 'Por favor, insira uma pergunta.' };
                    const calculateBtn = document.getElementById('calculate-btn');
                    calculateBtn.disabled = true;
                    calculateBtn.innerHTML = '<span class="animate-pulse">Pensando...</span>';
                    try {
                        const systemPrompt = "Você é 'Pequena Ajuda', um assistente de estudos. Resolva o problema do usuário e forneça uma explicação clara e passo a passo em português do Brasil. Divida a resposta em 'Resultado Final' e 'Passo a Passo'. O 'Resultado Final' deve ser curto. O 'Passo a Passo' deve detalhar o raciocínio. Use apenas HTML simples para formatação (<strong>, <ul>, <li>, <br>).";
                        const result = await callAIGeneric(query, systemPrompt);
                        const finalResultMatch = result.match(/Resultado Final:([\s\S]*?)Passo a Passo:/i);
                        const stepsMatch = result.match(/Passo a Passo:([\s\S]*)/i);
                        let finalResult = finalResultMatch ? finalResultMatch[1].trim() : result.split('<br>')[0];
                        let steps = stepsMatch ? stepsMatch[1].trim() : (finalResultMatch ? result.substring(finalResultMatch[0].length) : result);
                        return { result: finalResult, steps: steps };
                    } catch (error) {
                        return { result: 'Erro de Conexão', steps: `Ocorreu um erro ao contatar a IA. Detalhes: ${error.message}` };
                    } finally {
                        calculateBtn.disabled = false;
                        calculateBtn.innerHTML = 'Perguntar para a IA';
                    }
                }
            }
        ];
        
        async function callAIGeneric(prompt, systemPrompt) {
            const apiKey = "AIzaSyBj3Psc99slZeVq1IVIIZG89fp5g1rl5l4"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { const errorData = await response.json(); throw new Error(`API Error: ${errorData.error?.message || response.statusText}`); }
            const result = await response.json();
            const candidate = result.candidates?.[0];
            if (!candidate || !candidate.content?.parts?.[0]?.text) { throw new Error("Resposta da IA em formato inesperado."); }
            return candidate.content.parts[0].text;
        }

        async function callAI(prompt, systemPrompt) {
            const calculateBtn = document.getElementById('calculate-btn');
            calculateBtn.disabled = true;
            calculateBtn.innerHTML = '<span class="animate-pulse">Pensando...</span>';
            try {
                const responseText = await callAIGeneric(prompt, systemPrompt);
                return { result: responseText };
            } catch (error) {
                console.error("Error calling AI:", error);
                return { result: `<strong>Erro de Conexão:</strong> Ocorreu um erro ao contatar a IA. Detalhes: ${error.message}` };
            } finally {
                calculateBtn.disabled = false;
                calculateBtn.textContent = 'Calcular';
            }
        }


        // --- APPLICATION LOGIC ---
        const categories = [...new Set(formulas.map(f => f.category))].sort();

        const categoryColors = {
            'Matemática': 'from-blue-500 to-indigo-500', 'Física': 'from-yellow-500 to-orange-500',
            'Química': 'from-green-500 to-teal-500', 'Biologia': 'from-lime-500 to-emerald-500',
            'Geometria': 'from-purple-500 to-pink-500', 'Conversores': 'from-rose-500 to-red-500',
            'IA': 'from-fuchsia-500 to-purple-600', 'Meu Histórico': 'from-gray-500 to-blue-gray-500',
            'Sugestões': 'from-cyan-500 to-teal-400',
            'Português': 'from-amber-500 to-yellow-600',
            'Sair': 'from-red-500 to-orange-500',
            'Finanças': 'from-green-400 to-lime-500',
            'Saúde': 'from-red-500 to-rose-500'
        };

        const categoryIcons = {
            'Matemática': 'ph-calculator', 'Física': 'ph-atom', 'Química': 'ph-test-tube',
            'Biologia': 'ph-leaf', 'Geometria': 'ph-compass', 'Conversores': 'ph-arrows-clockwise',
            'IA': 'ph-sparkle', 'Meu Histórico': 'ph-clock-counter-clockwise',
            'Sugestões': 'ph-lightbulb',
            'Português': 'ph-books',
            'Sair': 'ph-sign-out',
            'Finanças': 'ph-chart-line-up',
            'Saúde': 'ph-heartbeat'
        };

        function showView(viewId) {
            [authView, mainMenu, listView, calculatorView, periodicTableView, historyView, suggestionsView].forEach(view => {
                if(view) view.classList.add('hidden');
            });
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.remove('hidden');
                currentView = viewId;
                window.scrollTo(0, 0);
            }
        }
        
        function renderMainMenu() {
            const menuGrid = mainMenu.querySelector('.grid');
            menuGrid.innerHTML = '';
            // Added "Sair" (Logout) to the categories list
            const allCategories = [...categories, 'Meu Histórico', 'Sugestões', 'Sair'].sort();

            allCategories.forEach(category => {
                const color = categoryColors[category] || 'from-gray-500';
                const icon = categoryIcons[category] || 'ph-question';
                const button = document.createElement('button');
                button.className = `p-4 sm:p-6 rounded-2xl text-white text-lg sm:text-xl font-bold shadow-lg transition-transform transform hover:scale-105 bg-gradient-to-br ${color}`;
                button.innerHTML = `<div class="flex flex-col items-center justify-center h-full"><i class="ph-fill ${icon} text-4xl sm:text-5xl mb-2"></i><span>${category}</span></div>`;
                
                button.addEventListener('click', () => {
                    if (category === 'Sair') {
                        sessionStorage.removeItem('isLoggedIn');
                        initializeApp();
                    } else if (category === 'Meu Histórico') {
                        renderHistoryView();
                        showView('history-view');
                    } else if (category === 'Sugestões') {
                        showView('suggestions-view');
                    } else {
                        currentCategory = category;
                        renderFormulaListView(category);
                        showView('list-view');
                    }
                });
                menuGrid.appendChild(button);
            });
        }
        
        function renderFormulaListView(category) {
            document.getElementById('list-title').textContent = category;
            const contentDiv = document.getElementById('list-content');
            contentDiv.innerHTML = '';
            
            const levels = ['Ensino Fundamental', 'Dia a Dia', 'Ensino Médio', 'Ensino Superior', 'Inteligência Artificial'];
            levels.forEach(level => {
                const formulasInLevel = formulas.filter(f => f.category === category && f.level === level);
                if (formulasInLevel.length > 0) {
                    const levelSection = document.createElement('div');
                    if(category !== 'IA') {
                        levelSection.innerHTML = `<h3 class="text-xl sm:text-2xl font-semibold mb-4 text-blue-600 dark:text-blue-400">${level}</h3>`;
                    }
                    const list = document.createElement('div');
                    list.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
                    
                    formulasInLevel.sort((a, b) => a.name.localeCompare(b.name)).forEach(formula => {
                        const card = document.createElement('div');
                        card.className = 'bg-white/80 dark:bg-gray-800/90 p-4 rounded-lg shadow-md hover:shadow-xl hover:ring-2 hover:ring-blue-400 transition-all cursor-pointer';
                        card.innerHTML = `<h4 class="font-bold text-lg">${formula.name}</h4>`;
                        card.addEventListener('click', () => {
                             if (formula.id === 'tabela-periodica') {
                                 renderPeriodicTable();
                                 showView('periodic-table-view');
                             } else {
                                 renderCalculator(formula.id);
                                 showView('calculator-view');
                             }
                        });
                        list.appendChild(card);
                    });
                    
                    levelSection.appendChild(list);
                    contentDiv.appendChild(levelSection);
                }
            });
        }
        
        function renderHistoryView() {
            const contentDiv = document.getElementById('history-content');
             try {
                 const history = JSON.parse(localStorage.getItem('calculationHistory')) || [];
                 if (history.length === 0) {
                     contentDiv.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Nenhum cálculo salvo.</p>';
                     return;
                 }
                 contentDiv.innerHTML = '';
                 history.forEach(item => {
                     const date = new Date(item.timestamp).toLocaleString('pt-BR');
                     const inputs = Object.entries(item.inputs||{}).map(([k,v])=>`<li><strong>${k}:</strong> ${v}</li>`).join('');
                     const card = document.createElement('div');
                     card.className = 'bg-white/70 dark:bg-gray-800/80 p-4 rounded-lg shadow';
                     card.innerHTML = `<p class="font-bold text-blue-600">${item.formulaName}</p><p class="text-sm text-gray-500 mb-2">${date}</p><ul class="text-sm list-disc list-inside mb-2">${inputs}</ul><p class="font-semibold text-green-700">Resultado: ${item.result}</p>`;
                     contentDiv.appendChild(card);
                 });
             } catch (e) {
                 contentDiv.innerHTML = '<p class="text-red-500">Erro ao carregar histórico.</p>';
             }
        }

        const suggestionForm = document.getElementById('suggestion-form');
        suggestionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const feedbackEl = document.getElementById('suggestion-feedback');
            const submitBtn = suggestionForm.querySelector('button[type="submit"]');

            const formData = new FormData(suggestionForm);
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="animate-pulse">Enviando...</span>';

            try {
                const response = await fetch(suggestionForm.action, {
                    method: 'POST', body: formData, headers: { 'Accept': 'application/json' }
                });
                if (response.ok) {
                    feedbackEl.textContent = 'Obrigado pela sua sugestão!';
                    feedbackEl.className = 'text-center mt-4 font-semibold text-green-600 dark:text-green-400';
                    suggestionForm.reset();
                } else { throw new Error('Falha no envio'); }
            } catch (error) {
                feedbackEl.textContent = "Oops! Houve um problema ao enviar.";
                feedbackEl.className = 'text-center mt-4 font-semibold text-red-500';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar Sugestão';
            }
        });
        
        function renderPeriodicTable() {
            const grid = document.getElementById('periodic-table-grid');
            grid.innerHTML = '';
            
            const mainElements = elements.filter(el => (el.category !== 'Lantanídeo' && el.category !== 'Actinídeo') || el.atomic_number === 57 || el.atomic_number === 89);
            
            mainElements.forEach(el => {
                const cell = document.createElement('div');
                const categoryClass = el.category.toLowerCase().replace(/\s+/g, '-').replace('ã','a').replace('ê','e').replace('é','e').replace('ó','o');
                cell.className = `element-cell ${categoryClass}`;
                cell.style.gridColumn = el.group;
                cell.style.gridRow = el.period;
                cell.innerHTML = `<div class="element-number">${el.atomic_number}</div><div class="element-symbol">${el.symbol}</div>`;
                cell.addEventListener('click', () => showElementDetails(el));
                grid.appendChild(cell);
            });
            
            const placeholderLa = document.createElement('div');
            placeholderLa.className = 'element-cell lanthanide-actinide-placeholder text-xs flex items-center justify-center';
            placeholderLa.style.cssText = 'grid-column: 3; grid-row: 6;';
            placeholderLa.innerHTML = '57-71';
            grid.appendChild(placeholderLa);

            const placeholderAc = document.createElement('div');
            placeholderAc.className = 'element-cell lanthanide-actinide-placeholder text-xs flex items-center justify-center';
            placeholderAc.style.cssText = 'grid-column: 3; grid-row: 7;';
            placeholderAc.innerHTML = '89-103';
            grid.appendChild(placeholderAc);

            const createSubTable = (containerId, subElements) => {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                container.classList.remove('hidden');
                subElements.forEach(el => {
                    const cell = document.createElement('div');
                    cell.className = `element-cell ${el.category.toLowerCase()} p-2`;
                    cell.innerHTML = `<div class="element-number text-[0.5rem]">${el.atomic_number}</div><div class="element-symbol text-base">${el.symbol}</div>`;
                    cell.addEventListener('click', () => showElementDetails(el));
                    container.appendChild(cell);
                });
            };

            createSubTable('lanthanide-container', elements.filter(el => el.category === 'Lantanídeo').sort((a,b) => a.atomic_number - b.atomic_number));
            createSubTable('actinide-container', elements.filter(el => el.category === 'Actinídeo').sort((a,b) => a.atomic_number - b.atomic_number));
            document.getElementById('element-details').classList.add('hidden');
        }

        function showElementDetails(el) {
            const detailsDiv = document.getElementById('element-details');
            detailsDiv.innerHTML = `
                <h4 class="text-lg font-bold mb-2">${el.name} (${el.symbol})</h4>
                <p><strong>Nº Atômico:</strong> ${el.atomic_number}</p>
                <p><strong>Massa Atômica:</strong> ${el.atomic_mass} u</p>
                <p><strong>Categoria:</strong> ${el.category}</p>
                <p><strong>Grupo:</strong> ${el.group > 0 ? el.group : 'Bloco f'}</p>
                <p><strong>Período:</strong> ${el.period}</p>
            `;
            detailsDiv.classList.remove('hidden');
        }
        
        async function renderCalculator(formulaId) {
            const formula = formulas.find(f => f.id === formulaId);
            if (!formula) return;
            
            document.getElementById('calculator-title').textContent = formula.name;
            const formulaDiv = document.getElementById('calculator-formula');
            katex.render(formula.formula_display, formulaDiv, { throwOnError: false });

            const descriptionDiv = document.getElementById('calculator-description');
            if (formula.description) {
                descriptionDiv.innerHTML = `<h3 class="font-semibold text-lg mb-2 text-gray-800 dark:text-gray-200">Sobre:</h3><p class="break-words">${formula.description}</p>`;
                descriptionDiv.classList.remove('hidden');
            } else {
                descriptionDiv.classList.add('hidden');
            }
            
            const inputsDiv = document.getElementById('calculator-inputs');
            inputsDiv.innerHTML = '';
            const calculateBtn = document.getElementById('calculate-btn');
            
            document.getElementById('calculator-results').classList.add('hidden');
            
            if (formula.inputs.length > 0) {
                calculateBtn.style.display = 'block';
                
                formula.inputs.forEach(input => {
                    const inputGroup = document.createElement('div');
                    let inputElementHTML = '';
                    
                    if (input.type === 'textarea') {
                        inputElementHTML = `<textarea id="${input.id}" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500 h-24" placeholder="Escreva seu texto aqui..."></textarea>`;
                        inputGroup.className = 'md:col-span-2';
                    }
                    else if (input.type === 'select') {
                        const optionsHTML = input.options.map(opt => `<option value="${opt.value}">${opt.text}</option>`).join('');
                        inputElementHTML = `<select id="${input.id}" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500">${optionsHTML}</select>`;
                    } else {
                        inputElementHTML = `<input type="text" inputmode="decimal" id="${input.id}" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500" placeholder="0">`;
                    }

                    inputGroup.innerHTML = `
                        <label for="${input.id}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">${input.label}</label>
                        <div class="flex items-center">
                            ${inputElementHTML}
                            ${input.unit ? `<span class="ml-2 text-gray-500 dark:text-gray-400">${input.unit}</span>` : ''}
                        </div>
                    `;
                    inputsDiv.appendChild(inputGroup);
                });
                
                // Add event listener for Enter key on all inputs
                const allInputs = inputsDiv.querySelectorAll('input, select, textarea');
                allInputs.forEach(input => {
                    input.addEventListener('keydown', (event) => {
                        if (event.key === 'Enter' && !event.shiftKey) {
                            event.preventDefault();
                            document.getElementById('calculate-btn').click();
                        }
                    });
                });

                const performCalculation = async () => {
                    const inputValues = {};
                    let hasError = false;
                    formula.inputs.forEach(input => {
                        const el = document.getElementById(input.id);
                        inputValues[input.id] = el.value;
                        if (!el.value) {
                            el.classList.add('border-red-500');
                            hasError = true;
                        } else {
                            el.classList.remove('border-red-500');
                        }
                    });
                    if(hasError) return;
                    
                    const resultData = await formula.calculationFunction(inputValues);
                    
                    document.getElementById('results-final').innerHTML = resultData.result;
                    document.getElementById('calculator-results').classList.remove('hidden');

                    const stepsContainer = document.getElementById('calculator-steps-container');
                    if(resultData.steps) {
                        stepsContainer.classList.remove('hidden');
                        document.getElementById('results-steps').innerHTML = resultData.steps;
                    } else {
                        stepsContainer.classList.add('hidden');
                    }
                    
                    if (formula.id !== 'ia-helper' && formula.category !== 'Português' && !resultData.result.includes('Erro')) {
                        saveToHistory(formula.name, inputValues, resultData.result);
                    }
                };
                
                const newBtn = calculateBtn.cloneNode(true);
                newBtn.id = 'calculate-btn'; // Ensure the new button keeps the ID
                newBtn.textContent = (formula.id === 'ia-helper' || formula.category === 'Português') ? 'Analisar com IA' : 'Calcular';
                calculateBtn.parentNode.replaceChild(newBtn, calculateBtn);
                newBtn.addEventListener('click', performCalculation);
            } else {
                calculateBtn.style.display = 'none';
            }
        }

        // --- Navigation ---
        document.querySelectorAll('.back-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentView === 'calculator-view' || currentView === 'periodic-table-view') {
                    if (currentCategory) {
                        renderFormulaListView(currentCategory);
                        showView('list-view');
                    } else {
                        // This case might not be reachable anymore but is good for safety
                        showView('main-menu');
                    }
                } else if (currentView === 'list-view' || currentView === 'history-view' || currentView === 'suggestions-view') {
                    currentCategory = ''; 
                    showView('main-menu');
                } else if (currentView === 'auth-view') {
                    // No back button on auth view, but for consistency
                    initializeApp();
                }
            });
        });
        
        // --- INITIALIZATION & AUTH LOGIC ---
        function initializeApp() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn') === 'true';
            const userAccount = localStorage.getItem('pequenaAjudaUser');

            if (isLoggedIn) {
                renderMainMenu();
                showView('main-menu');
            } else {
                if (userAccount) {
                    loginFormContainer.classList.remove('hidden');
                    registerFormContainer.classList.add('hidden');
                } else {
                    registerFormContainer.classList.remove('hidden');
                    loginFormContainer.classList.add('hidden');
                }
                showView('auth-view');
            }
        }

        function notifyLogin(userData) {
             try {
                const trackerForm = document.getElementById('login-tracker-form');
                if (trackerForm) {
                    document.getElementById('login-tracker-info').value = `Utilizador: ${userData.name} (${userData.email})`;
                    document.getElementById('login-tracker-date').value = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });
                    
                    const formData = new FormData(trackerForm);
                    fetch(trackerForm.action, {
                        method: 'POST',
                        body: formData,
                        headers: { 'Accept': 'application/json' }
                    }).then(response => {
                        if(response.ok) console.log('Notificação de login enviada.');
                        else console.error('Falha ao enviar notificação de login.');
                    }).catch(error => console.error('Erro de rede ao notificar login:', error));
                }
            } catch(e) {
                console.error("Erro no notificador de login:", e);
            }
        }

        // --- AUTH FORM HANDLERS ---
        document.getElementById('show-register-form').addEventListener('click', (e) => {
            e.preventDefault();
            loginFormContainer.classList.add('hidden');
            registerFormContainer.classList.remove('hidden');
        });

        document.getElementById('show-login-form').addEventListener('click', (e) => {
            e.preventDefault();
            registerFormContainer.classList.add('hidden');
            loginFormContainer.classList.remove('hidden');
        });

        const registerForm = document.getElementById('register-form');
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const feedbackEl = document.getElementById('register-feedback');
            const submitBtn = registerForm.querySelector('button[type="submit"]');
            
            feedbackEl.textContent = '';
            const formData = new FormData(registerForm);
            const userObject = Object.fromEntries(formData.entries());

            // Simple encoding for password - NOT for production security
            const encodedPassword = btoa(userObject.senha);
            const userDataToStore = {
                name: userObject.nome,
                sobrenome: userObject.sobrenome,
                email: userObject.email,
                password: encodedPassword
            };
            localStorage.setItem('pequenaAjudaUser', JSON.stringify(userDataToStore));
            
            // Prepare form data for Formspree (without password)
            const formspreeData = new FormData(registerForm);
            formspreeData.delete('senha');

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="animate-pulse">A registar...</span>';

            try {
                const response = await fetch(registerForm.action, {
                    method: 'POST',
                    body: formspreeData,
                    headers: { 'Accept': 'application/json' }
                });
                if (response.ok) {
                    sessionStorage.setItem('isLoggedIn', 'true');
                    notifyLogin(userDataToStore); // Notify on successful registration and login
                    initializeApp();
                } else {
                    throw new Error('Falha no registo. Tente novamente.');
                }
            } catch (error) {
                feedbackEl.textContent = `Oops! Houve um problema: ${error.message}`;
                feedbackEl.className = 'text-center mt-4 font-semibold text-red-500';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Registar';
            }
        });

        const loginForm = document.getElementById('login-form');
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const feedbackEl = document.getElementById('login-feedback');
            const email = loginForm.querySelector('#login-email').value;
            const password = loginForm.querySelector('#login-senha').value;

            const storedUserJSON = localStorage.getItem('pequenaAjudaUser');
            let loginSuccess = false;
            let storedUser = null;

            if (storedUserJSON) {
                storedUser = JSON.parse(storedUserJSON);
                // Compare encoded passwords
                if (email === storedUser.email && btoa(password) === storedUser.password) {
                    loginSuccess = true;
                }
            }

            if (loginSuccess) {
                feedbackEl.textContent = 'Login bem-sucedido!';
                feedbackEl.className = 'text-center mt-4 font-semibold text-green-500';
                sessionStorage.setItem('isLoggedIn', 'true');
                notifyLogin(storedUser); // Send login notification
                setTimeout(initializeApp, 1000); // Wait a second before redirecting
            } else {
                feedbackEl.textContent = 'E-mail ou senha inválidos.';
                feedbackEl.className = 'text-center mt-4 font-semibold text-red-500';
            }
        });

        initializeApp(); // Start the app
    });
    </script>
</body>
</html>

